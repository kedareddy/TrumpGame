<!DOCTYPE html>
<!--  This site was created in Webflow. http://www.webflow.com -->
<!--  Last Published: Sun Jan 15 2017 09:20:59 GMT+0000 (UTC)  -->
<html class="oldhomehtml" data-wf-page="5875327699546d416a201491" data-wf-site="5875327699546d416a201490">
<head>
  <meta charset="utf-8">
  <title>AngerTranslator</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="Webflow" name="generator">

    
    
    
    
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/angertranslator.webflow.css" rel="stylesheet" type="text/css">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js"></script>
    
  <script type="text/javascript">
    WebFont.load({
      google: {
        families: ["Montserrat:400,700","Oswald:300,400,700"]
      }
    });
  </script>
  <script src="js/modernizr.js" type="text/javascript"></script>
  <link href="https://daks2k3a4ib2z.cloudfront.net/img/favicon.ico" rel="shortcut icon" type="image/x-icon">
  <link href="https://daks2k3a4ib2z.cloudfront.net/img/webclip.png" rel="apple-touch-icon">
    
    
    <script type="text/javascript" src="js/libgif.js"></script>
    <script src='js/gifshot.min.js'></script>
    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.js"></script>-->
    
    <!--<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>-->
    
    
    
    <link rel="stylesheet" type="text/css" href="js/javascript.fullPage.css" />
    <script type="text/javascript" src="js/javascript.fullPage.min.js"></script>
    
    <!-- load that lib -->
    <script src="js/playloops.js"></script>
    <script src="js/close-pixelate.js"></script>

    <script src="js/spin.min.js"></script>

    
</head>
<body class="oldhomebody" id="thebody">
    <!-- -->
<div id="spinnerParent" style="position:absolute;z-index:500;display:none; height:100%; width:100%; background-color:rgba(0, 0, 0, 0.8);"></div>  
<div id="fakeInputDiv" style="position:absolute; z-index: 100; display:none; height:30%;width:100%; background-color:rgba(0, 0, 0, 0.8); top:0px; text-align: center; padding-top: 6%;">
    <input id="fakeInput" type="text" name="country" value="NOT MY PRESIDENT" class="step4input" style="height: 28%;">
</div>
<div id="warningDiv" style="position:absolute;z-index:500;display:none; height:100%; width:100%; background-color:rgba(0, 0, 0, 0.8);text-align:center; color: #666; vertical-align: middle;">
<div id="warningContentDiv" style="height:auto; width:85%; background-color:rgba(250, 250, 250, 0.8);font-family: 'Oswald medium', sans-serif; font-size: 35px; margin-left: auto; margin-right: auto; left:0; right:0; padding-top: 2%; padding-bottom: 2%;">
    <h1>
        Please switch to Chrome for the best experience! 
    </h1>
    <br>
    <button id="warningButton" style="padding:2%;">
        OKAY
    </button>
    </div>
</div>
  <div class="modaldiv" data-ix="displaynoneonload">
    <!--<div class="modalcontentwrapper">-->
        <div class="modalcontent">
            <!-- data-ix="closemodal" -->
          <div class="modalclosediv"  data-ix="closemodal" ><img class="closeicon" id="closeiconwebcam" src="images/VisualEditor_-_Icon_-_Close-01.svg">
          </div>
          <div class="modalcanvasdiv">
            <h1 class="webcamhelpertext">Click To Change Filter</h1>
 
            <img class="webcamoverlayimage" src="assets/FinalArt/LeiaHead2.gif">
               <video autoplay="true" class="webcamvideo" id="videoElement" width="100%" height="75%"></video> 
            <!--<div class="webcamvideo" id="videoElement"></div> -->
            <canvas class="webcamcanvas" id="webcamcanvas"></canvas>
          </div>
          <div class="modalcameradiv">
                          <div class="webcampreviewdiv">
              <img class="webcampreviewimages" id="p1" src="images/Blank.png">
              <img class="webcampreviewimages" id="p2" src="images/Blank.png">
              <img class="webcampreviewimages" id="p3" src="images/Blank.png">
              <img class="webcampreviewimages" id="p4" src="images/Blank.png">
            </div> 
              <img class="photobutton" src="images/cricle.png">
          </div>
        </div>
   <!-- </div>  -->
    <div class="modalapprovecontent">
      <div class="modalclosediv"  data-ix="closemodal" ><img class="closeicon" id="closeiconapprove" src="images/VisualEditor_-_Icon_-_Close-01.svg">
      </div>
      <div class="modalcanvasdiv">
        <h1 class="approvehelpertext">Click To Change Filter</h1>
        <img class="approveimage" id="approveimg" src="assets/FinalArt/LeiaHead2.gif">
      </div>
      <div class="modalyesno">
        <div class="modalyes" ><img class="yesbutton" src="images/choices-01.svg" data-theme="b" data-textonly="false" data-textvisible="true" data-msgtext="Loading theme b" data-inline="true">
        </div>
        <div class="modalno"><img class="nobutton" src="images/choices-02.svg">
        </div>
      </div>
    </div>
  </div>
  <div class="headersection">
    <div class="w-container">
      <div class="headerdiv">
        <!--<h1 class="logoheading">Play Loops</h1>-->
           <img class="logoheading" src="images/bluelogo.svg">  
      </div>
    </div>
  </div>
  <div id="fullpage">
 
<section class="section mostsections" id="SectionStep1">
    <div class="w-container">
      <div class="mosteditordivs">
        <div class="stepformwrapper w-form">
          <form class="formdiv" data-name="Email Form" id="email-form" name="email-form">
            <div class="stepnumdiv">
              <h1 class="stepnumber">1.</h1><img class="stepnumicon" src="images/symbols-1.svg">
            </div>
            <div class="stepinputdiv">
              <label class="step3title" for="name-3">Choose Your Hero!</label>
              <div class="step3heroesdiv">
                <a class="hero1link w-inline-block" href="#"><img class="hr1" src="images/Leia SVG.svg">
                </a>
                <a class="hero2link w-inline-block" href="#"><img class="hr2" src="images/Luther SVG.svg">
                </a>
                <a class="hero3link w-inline-block" href="#"><img class="hr3" src="images/Hulk SVG.svg">
                </a>
                <a class="hero4link w-inline-block" href="#"><img class="hr4" src="images/Person_icon_BLACK-01.svg">
                </a>
              </div>
            </div>
            <div class="stepbutton three">
              <a class="w-inline-block" href="#Step2"><img class="nextlinkblock" src="images/25243.svg">
              </a>
            </div>
          </form>
          <div class="w-form-done">
            <div></div>
          </div>
          <div class="w-form-fail">
            <div></div>
          </div>
        </div>
      </div>
    </div>
  </section>      
  <section class="section mostsections" id="SectionStep2">
    <div class="mostcontainers w-container">
      <div class="mosteditordivs">
        <div class="stepformwrapper w-form">
          <form class="formdiv" data-name="Email Form" id="email-form" name="email-form">
            <div class="stepnumdiv">
              <h1 class="stepnumber">2.</h1><img class="stepnumicon" src="images/symbols-1.svg">
            </div>
            <div class="step2 stepinputdiv">
              <div class="step2selfiediv">
                <label class="step2title" for="name-2">Add Your Face!</label>
                <a class="w-inline-block" ><img class="step2icon" src="images/camera.svg">
                </a>
              </div>
              <div class="step2or">
                <h1 class="step2ortext">or</h1>
              </div>
              <div class="step2uploaddiv">
                <label class="step2title" for="name-2">Upload</label>
                <a class="w-inline-block" ><img class="step2icon upload" src="images/camera.svg">
                </a>
              </div>
            </div>
            <div class="stepbutton two">
              <a class="w-inline-block" href="#Step3"><img class="nextlinkblock" src="images/25243.svg">
              </a>
            </div>
          </form>
          <div class="w-form-done">
            <div></div>
          </div>
          <div class="w-form-fail">
            <div></div>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <section class="section mostsections" id="SectionStep3">
    <div class="w-container">
      <div class="mosteditordivs">
        <div class="stepformwrapper w-form">
          <form class="formdiv" onsubmit="step4Submit()" data-name="Email Form" data-redirect="javascript:void(0);" id="email-form" name="email-form" redirect="javascript:void(0);">
            <div class="stepnumdiv">
              <h1 class="stepnumber">3.</h1><img class="stepnumicon" src="images/symbols-1.svg">
            </div>
            <div class="stepinputdiv 4" id="step4inputdiv">
              <label class="step4title" for="name-4">Your Message</label>
              <input class="step4input w-input" data-name="Name 4" id="name-4" maxlength="256" name="name-4" placeholder="NOT MY PRESIDENT" type="text">
            </div>
            <div class="four stepbutton"><a class="submitbutton w-button" href="index.html"  id="createButton" onclick='return false;'>CREATE</a>
            </div>
          </form>
          <div class="w-form-done">
            <div></div>
          </div>
          <div class="w-form-fail">
            <div></div>
          </div>
        </div>
      </div>
    </div>
  </section>
  </div>
  <div class="mostsections">
    <div class="extraspacecontainer w-container">
      <div class="last mosteditordivs"></div>
    </div>
  </div>
  <div class="previewfootersection" data-ix="displaynoneonload" >
    <div class="previewfootercontainer w-container">
      <div class="previewfooterdiv">
        <h1 class="footertext">I am<br>Asian American</h1><img class="previewimage" id="previewimage" src="images/LEIA_IDLE_INK.gif">
      </div>
    </div>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js" type="text/javascript"></script>
  <script src="js/webflow.js" type="text/javascript"></script>

    <script src='js/jquery.transit.js'></script>
    <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
    

<script type="text/javascript">
    //var testImage = new Image();
    var spinner; 
    var opts;    
    var heightAvailable; 
    var widthAvailable;
    var xOffset; 
    var yOffset; 
    var bareFaceSrc;// = []; 
    var gifFrames = []; 
    var allMyFaces = []; 
    var faceSrcData;
    var faceSrcDataJ;
    var faceImage = new Image(); 
    var inputText1 = "I am American";
    var inputText4 = "Not my president"; 
    //testImage.src = 'assets/Test/LEIA_IDLE_INK.gif'; 
    var isMobile;
    //timeout variables
    var x, y = 1;
    //webcam stream, used to stop later. 
    var localStream; 
    
    var head_urls = ['/assets/FinalArt/FakeHead/oprah_0003_Layer-1.png','/assets/FinalArt/FakeHead/oprah_0002_Layer-2.png','/assets/FinalArt/FakeHead/oprah_0001_Layer-3.png','/assets/FinalArt/FakeHead/oprah_0000_Layer-4.png'];
    var blank_heads = [];
    var blankHeadCounter = 0; 
    for (a = 0; a < head_urls.length; a++) {
        blank_heads[a] = new Image();
        blankHeadCounter++;
        blank_heads[a].src = head_urls[a];
    }    
    

    
    
    /*var click_urls = ['images/click/click_0003_Layer-1.png','images/click/click_0002_Layer-2.png', 'images/click/click_0001_Layer-3.png', 'images/click/click_0000_Layer-4.png'];
    var click_images = [];
    for (a = 0; a < click_urls.length; a++) {
        click_images[a] = new Image();
        click_images[a].src = click_urls[a];
    }*/
    
    var leiaidle_urls = ['/assets/FinalArt/LeiaIdle/leia_idle_0003_Layer 1_new.jpg','/assets/FinalArt/LeiaIdle/leia_idle_0002_Layer 2_new.jpg', '/assets/FinalArt/LeiaIdle/leia_idle_0001_Layer 3_new.jpg', '/assets/FinalArt/LeiaIdle/leia_idle_0000_Layer 4_new.jpg'];
        var leiajab_urls = ['/assets/FinalArt/LeiaJab/leia_jab_0003_Layer 1_new.jpg', '/assets/FinalArt/LeiaJab/leia_jab_0002_Layer 2_new.jpg', '/assets/FinalArt/LeiaJab/leia_jab_0001_Layer 3_new.jpg', '/assets/FinalArt/LeiaJab/leia_jab_0000_Layer 4_new.jpg'];
        var leiapunch_urls = [    '/assets/FinalArt/LeiaPunch/leia_punch_0009_Layer 1_new.jpg',
                                    '/assets/FinalArt/LeiaPunch/leia_punch_0008_Layer 2_new.jpg', 
                                  '/assets/FinalArt/LeiaPunch/leia_punch_0007_Layer 3_new.jpg', 
                                  '/assets/FinalArt/LeiaPunch/leia_punch_0006_Layer 4_new.jpg',
                                  '/assets/FinalArt/LeiaPunch/leia_punch_0005_Layer 5_new.jpg',
                                  '/assets/FinalArt/LeiaPunch/leia_punch_0004_Layer 6_new.jpg',
                                  '/assets/FinalArt/LeiaPunch/leia_punch_0003_Layer 7_new.jpg',
                                  '/assets/FinalArt/LeiaPunch/leia_punch_0002_Layer 8_new.jpg',
                                  '/assets/FinalArt/LeiaPunch/leia_punch_0001_Layer 9_new.jpg',
                                  '/assets/FinalArt/LeiaPunch/leia_punch_0000_Layer 10_new.jpg',
                                 ];
    var leiaidle_images = [];
    for (i = 0; i < leiaidle_urls.length; i++) {
        leiaidle_images[i] = new Image();
        leiaidle_images[i].src = leiaidle_urls[i];
    }
    var leiajab_images = [];
    for (j = 0; j < leiajab_urls.length; j++) {
        leiajab_images[j] = new Image();
        leiajab_images[j].src = leiajab_urls[j];
    }
    var leiapunch_images = [];
    for (k = 0; k < leiapunch_urls.length; k++) {
        leiapunch_images[k] = new Image();
        leiapunch_images[k].src = leiapunch_urls[k];
    }
    
    var lutheridle_urls = ['/assets/FinalArt/LutherIdle/luther_idle_0003_Layer 1_new.jpg','/assets/FinalArt/LutherIdle/luther_idle_0002_Layer 2_new.jpg', '/assets/FinalArt/LutherIdle/luther_idle_0001_Layer 3_new.jpg', '/assets/FinalArt/LutherIdle/luther_idle_0000_Layer 4_new.jpg'];
        var lutherjab_urls = ['/assets/FinalArt/LutherJab/luther_jab_0003_Layer 1_new.jpg','/assets/FinalArt/LutherJab/luther_jab_0002_Layer 2_new.jpg', '/assets/FinalArt/LutherJab/luther_jab_0001_Layer 3_new.jpg', '/assets/FinalArt/LutherJab/luther_jab_0000_Layer 4_new.jpg'];
        var lutherpunch_urls = ['/assets/FinalArt/LutherPunch/luther_punch_0009_Layer 1_new.jpg',
                                  '/assets/FinalArt/LutherPunch/luther_punch_0008_Layer 2_new.jpg', 
                                  '/assets/FinalArt/LutherPunch/luther_punch_0007_Layer 3_new.jpg', 
                                  '/assets/FinalArt/LutherPunch/luther_punch_0006_Layer 4_new.jpg',
                                  '/assets/FinalArt/LutherPunch/luther_punch_0005_Layer 5_new.jpg',
                                  '/assets/FinalArt/LutherPunch/luther_punch_0004_Layer 6_new.jpg',
                                  '/assets/FinalArt/LutherPunch/luther_punch_0003_Layer 7_new.jpg',
                                  '/assets/FinalArt/LutherPunch/luther_punch_0002_Layer 8_new.jpg',
                                  '/assets/FinalArt/LutherPunch/luther_punch_0001_Layer 9_new.jpg',
                                  '/assets/FinalArt/LutherPunch/luther_punch_0000_Layer 10_new.jpg',
                                 ];
    var lutheridle_images = [];
    for (l = 0; l < lutheridle_urls.length; l++) {
        lutheridle_images[l] = new Image();
        lutheridle_images[l].src = lutheridle_urls[l];
    }
    var lutherjab_images = [];
    for (m = 0; m < leiajab_urls.length; m++) {
        lutherjab_images[m] = new Image();
        lutherjab_images[m].src = lutherjab_urls[m];
    }
    var lutherpunch_images = [];
    for (n = 0; n < lutherpunch_urls.length; n++) {
        lutherpunch_images[n] = new Image();
        lutherpunch_images[n].src = lutherpunch_urls[n];
    }
    
    
    var hulkidle_urls = ['/assets/FinalArt/HulkIdle/hulk_idle_0003_Layer 1_new.jpg','/assets/FinalArt/HulkIdle/hulk_idle_0002_Layer 2_new.jpg', '/assets/FinalArt/HulkIdle/hulk_idle_0001_Layer 3_new.jpg', '/assets/FinalArt/HulkIdle/hulk_idle_0000_Layer 4_new.jpg'];
        var hulkjab_urls = ['/assets/FinalArt/HulkJab/hulk_jab_0000_Layer 4_new.jpg', '/assets/FinalArt/HulkJab/hulk_jab_0001_Layer 3_new.jpg',  '/assets/FinalArt/HulkJab/hulk_jab_0002_Layer 2_new.jpg',  '/assets/FinalArt/HulkJab/hulk_jab_0003_Layer 1_new.jpg'];
        var hulkpunch_urls = ['/assets/FinalArt/HulkPunch/hulk_punch_0009_Layer 1_new.jpg', 
            '/assets/FinalArt/HulkPunch/hulk_punch_0008_Layer 2_new.jpg',                                
                                    '/assets/FinalArt/HulkPunch/hulk_punch_0007_Layer 3_new.jpg', 
                                  '/assets/FinalArt/HulkPunch/hulk_punch_0006_Layer 4_new.jpg',
                                  '/assets/FinalArt/HulkPunch/hulk_punch_0005_Layer 5_new.jpg',
                                  '/assets/FinalArt/HulkPunch/hulk_punch_0004_Layer 6_new.jpg',
                                  '/assets/FinalArt/HulkPunch/hulk_punch_0003_Layer 7_new.jpg',
                                  '/assets/FinalArt/HulkPunch/hulk_punch_0002_Layer 8_new.jpg',
                                  '/assets/FinalArt/HulkPunch/hulk_punch_0001_Layer 9_new.jpg',
                                  '/assets/FinalArt/HulkPunch/hulk_punch_0000_Layer 10_new.jpg',
                                 ];
    var hulkidle_images = [];
    for (t = 0; t < hulkidle_urls.length; t++) {
        hulkidle_images[t] = new Image();
        hulkidle_images[t].src = hulkidle_urls[t];
    }
    var hulkjab_images = [];
    for (u = 0; u < hulkjab_urls.length; u++) {
        hulkjab_images[u] = new Image();
        hulkjab_images[u].src = hulkjab_urls[u];
    }
    var hulkpunch_images = [];
    for (v = 0; v < hulkpunch_urls.length; v++) {
        hulkpunch_images[v] = new Image();
        hulkpunch_images[v].src = hulkpunch_urls[v];
    }
    
    function step4Submit(){
        console.log("form submitted!");
        if($("#name-4").is(":focus")){
            $("#fakeInputDiv").hide();
            $(".step4input").css({"position": "", "top": "", "max-width": ""});
        }
    }
    
    jQuery('body').bind('focusin focus', function(e){
          e.preventDefault();
    });  
    jQuery('input.your-input-class').bind('focusin focus', function(e){
            e.preventDefault();
    });
    
    
    var mWidth, mHeight; 
    
      $(document).ready(function(){
        /*********CHANGE HELP TEXT TO TAP WHEN ON MOBILE****/  
        function isMobile() {
          try{ document.createEvent("TouchEvent"); return true; }
          catch(e){ return false; }
        }
        if(isMobile() == true){
            //console.log("should say click"); 
            $(".webcamhelpertext").text("Tap To Change Filter");
            $(".approvehelpertext").text("Tap To Change Filter");
        }
        //var isChrome = !!window.chrome && !!window.chrome.webstore;
       // if(isChrome == false){
         //   $("#warningDiv").show(); 
        //}
        var isChromium = window.chrome,
        winNav = window.navigator,
        vendorName = winNav.vendor,
        isOpera = winNav.userAgent.indexOf("OPR") > -1,
        isIEedge = winNav.userAgent.indexOf("Edge") > -1,
        isIOSChrome = winNav.userAgent.match("CriOS");

        if(isIOSChrome){
           // is Google Chrome on IOS
        } else if(isChromium !== null && isChromium !== undefined && vendorName === "Google Inc." && isOpera == false && isIEedge == false) {
           // is Google Chrome
        } else { 
           // not Google Chrome 
            $("#warningDiv").show(); 
        }
  
          
        //retake photo  
        $( "#warningButton" ).on('touchend click', function(){ 
            $("#warningButton").transition({filter: 'invert(100%)' }, 100, 'out', function() {     
                $("#warningButton").transition({filter: 'invert(0%)' }, 100, 'in', function() {    
                    $('#warningDiv').hide(); 
                });
            });
        });
        $( "#warningButton" ).hover( 
            function(){  
                $("#warningButton").transition({opacity: .6 }, 100, 'in'); 
            },
            function(){  
                $("#warningButton").transition({opacity: 1.0 }, 100, 'in'); 
            }
        );  
          
          
       // var webvideo = document.getElementById('videoElement');
        var wCanvas = document.getElementById('webcamcanvas');  
        var selectedBody = "hulk";  
        var clip_image = new Image();
        clip_image.src = 'assets/FinalArt/leia_facearea.png';
        var faceOutlines = [];
        var faceAreas = []; 
        //var imageLeia = new Image();
        //imageLeia.src = 'assets/FinalArt/LeiaHeadSingle.png'; 
        var faces = { 
            leia : {   clipurl:['assets/FinalArt/LeiaHead/leia_facearea_0006_Layer-1.png',
                               'assets/FinalArt/LeiaHead/leia_facearea_0005_Layer-2.png',
                               'assets/FinalArt/LeiaHead/leia_facearea_0004_Layer-3.png',
                               'assets/FinalArt/LeiaHead/leia_facearea_0003_Layer-4.png'],
                       pngurl:['assets/FinalArt/LeiaHead/head_0006_Layer-1.png',
                              'assets/FinalArt/LeiaHead/head_0005_Layer-2.png',
                              'assets/FinalArt/LeiaHead/head_0004_Layer-3.png',
                              'assets/FinalArt/LeiaHead/head_0003_Layer-4.png']
                   },
            pussyhat : {   clipurl:['assets/FinalArt/PussyHatHead/pussyhat_facearea_0004_Layer-1.png',
                               'assets/FinalArt/PussyHatHead/pussyhat_facearea_0003_Layer-2.png',
                               'assets/FinalArt/PussyHatHead/pussyhat_facearea_0002_Layer-3.png',
                               'assets/FinalArt/PussyHatHead/pussyhat_facearea_0001_Layer-4.png'],
                           pngurl:['assets/FinalArt/PussyHatHead/pussyhat__0004_Layer-1.png',
                              'assets/FinalArt/PussyHatHead/pussyhat__0003_Layer-2.png',
                              'assets/FinalArt/PussyHatHead/pussyhat__0002_Layer-3.png',
                              'assets/FinalArt/PussyHatHead/pussyhat__0001_Layer-4.png']
                       },
            hat : {   clipurl:['assets/FinalArt/HatHead/hat_facearea_0004_Layer-1.png',
                               'assets/FinalArt/HatHead/hat_facearea_0003_Layer-2.png',
                               'assets/FinalArt/HatHead/hat_facearea_0002_Layer-3.png',
                               'assets/FinalArt/HatHead/hat_facearea_0001_Layer-4.png'],
                           pngurl:['assets/FinalArt/HatHead/hat_0004_Layer-1.png',
                              'assets/FinalArt/HatHead/hat_0003_Layer-2.png',
                              'assets/FinalArt/HatHead/hat_0002_Layer-3.png',
                              'assets/FinalArt/HatHead/hat_0001_Layer-4.png']
                       }
        };
        
        var leiahead_images = [];
        var leiaclip_images = []; 
        for (p = 0; p < faces["leia"].pngurl.length; p++) { 
            //overlay images
            leiahead_images[p] = new Image();
            leiahead_images[p].onload= function(){
                
            };
            leiahead_images[p].src = faces["leia"].pngurl[p];
            //face area images
             leiaclip_images[p] = new Image();
            leiaclip_images[p].onload= function(){
                
            };
            leiaclip_images[p].src = faces["leia"].clipurl[p];
        }  
        var pussyhathead_images = [];
        var pussyhatclip_images = []; 
        for (q = 0; q < faces["pussyhat"].pngurl.length; q++) { 
            pussyhathead_images[q] = new Image();
            pussyhathead_images[q].onload= function(){
                
            };
            pussyhathead_images[q].src = faces["pussyhat"].pngurl[q];
            
            pussyhatclip_images[q] = new Image();
            pussyhatclip_images[q].onload= function(){
                
            };
            pussyhatclip_images[q].src = faces["pussyhat"].clipurl[q];
        }  
        var hathead_images = [];
        var hatclip_images = []; 
        for (r = 0; r < faces["hat"].pngurl.length; r++) { 
            hathead_images[r] = new Image();
            hathead_images[r].onload= function(){
                
            };
            hathead_images[r].src = faces["hat"].pngurl[r];
            
            hatclip_images[r] = new Image();
            hatclip_images[r].onload= function(){
                
            };
            hatclip_images[r].src = faces["hat"].clipurl[r];
        }  
        /*for(var key in faces) {
            if (faces.hasOwnProperty(key)) {
                preloadImage(faces[key].clipurl);
            }
        }*/
        var currentface = "leia";
          
          
          
          
        fullpage.initialize('#fullpage', {
            anchors: ['Step1', 'Step2', 'Step3'],
            menu: '#menu',
            css3:true
        });
          
        /**********CAPTURE STEP 4**********/  
        var step4Input = document.getElementsByClassName("step4input w-input")[0];
        
        step4Input.addEventListener("input", function(e) {
            inputText4 = step4Input.value;
            $("#fakeInput").val(inputText4);
            console.log("Trump Message: " + inputText4);
        }, false);
        /****************************************/  
        
        /* CODE TO DISPLAY WEBCAM FEED ON MODAL WINDOW */ 
        var video = document.querySelector("#videoElement");
       // var track; 
        var overlayImageUrls = ["assets/FinalArt/hat.gif", "assets/FinalArt/pussyhatPink.gif", "assets/FinalArt/LeiaHead2.gif"]; 
        var overlayindex = 0; 
        var timeSelfieNow; 
        var lastSelfieTime = 0; 
        var orgVideo;  
        $( ".step2icon" ).on('touchend click', function(){
            timeSelfieNow = new Date().getTime();
            if((timeSelfieNow - lastSelfieTime) > 50){
                lastSelfieTime = new Date().getTime();
           
                //$(".step2icon").transition({filter: 'invert(100%)' }, 150, 'out', function() {
                    //$(".step2icon").transition({filter: 'invert(0%)' }, 500, 'in', function() { 
                        // alert("getting clickghjg");
                        $('.modaldiv').css('display', 'inline-block');
                        $('.modalcontent').css('display', 'inline-block');
                        //$(".webcamoverlayimage").hide(); 
                
                      /*  navigator.mediaDevices.getUserMedia({ video: true, audio: false })
                      .then(function (stream) { 
                            videoElement.srcObject = stream;
                            handleVideo(); 
                            //stream => videoElement.srcObject = stream;
                           
                        }) 
                      .catch(e => log(e.name + ": "+ e.message));
                        */
                
                      if(localStream!= null){
                          var track = localStream.getTracks()[0];
                          track.stop();
                      }
                      navigator.mediaDevices.getUserMedia({video: true, audio:false})
                      .then(stream => videoElement.srcObject = stream)
                      .then(stream => localStream = stream)
                      .then(() => new Promise(resolve => video.onloadedmetadata = resolve))
                      .then(() => handleVideo())
                      .catch(e => console.log(e));
                
                        /*orgVideo = document.querySelector("#videoElement");

                        navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia || navigator.oGetUserMedia;
 
                        if (navigator.getUserMedia) {       
                            navigator.getUserMedia({audio: false, video: true}, handleVideo, videoError);
                        }*/
                
                       /* mWidth =  $('.modalcontent').width();
                        
                        mHeight = mWidth/(600/450);
                        Webcam.set({
                            width: mWidth,
                            height: mHeight
                        });
                //flip_horiz: true
                        Webcam.attach( '#videoElement' );

                        Webcam.on( 'live', function() {
                              $(".webcamoverlayimage").show(); 
                                handleVideo();
                        } );*/
                    //}); 
                //});
            }
        });  
    
        $( ".step2icon" ).hover( 
            function(){  
                $(".step2icon").transition({opacity: 0.4 }, 200, 'in'); 
            },
            function(){  
                $(".step2icon").transition({opacity: 1.0 }, 100, 'in'); 
            }
        ); 
          
       /* function handleVideo(stream) {
            orgVideo.src = window.URL.createObjectURL(stream);
        }

        function videoError(e) {
            // do something
        }  */
          
        
        function preloadImage(url)
        {
            var img=new Image();
            img.src=url;
        }  

        function handleVideo() {
             mWidth =  $('.modalcontent').width();
             mHeight = mWidth/(600/450);
            
             var aspectOImage = $(".webcamoverlayimage").width()/$(".webcamoverlayimage").height();
            //console.log("dasfd");
            var videoElement = document.getElementById("videoElement");
            assignCurrentFace(overlayindex);
            
            var img = new Image();
            img.onload = function()
            {
                // Load completed
                $(".webcamoverlayimage").attr('src', this.src);
                
            };
            img.src = overlayImageUrls[overlayindex];
            
            //setTimeout(function() {
                // var maskH = $( "#videoElement" ).find("video").height();
                var maskH = videoElement.clientHeight;
                 var maskW = maskH * aspectOImage; 
                console.log("video h: " + maskH + "overlayw: " + maskW + " aspect: " + aspectOImage ); 
                 $( ".webcamoverlayimage" ).width(maskW);
                 $( ".webcamoverlayimage" ).height("auto");
                 $(".approveimage").width($( ".webcamoverlayimage" ).width());
                $(".approveimage").height("auto");
            //}, 2000);
        }
          
        function assignCurrentFace(indexNum){
            if(indexNum ==0){
                currentface = "hat"; 
            }
            else if(indexNum ==1){
                currentface = "pussyhat";
            }
            else if(indexNum ==2){
                currentface = "leia";
            }
       }
            
        //cycle overlay images
        var filterChangeCounter = 0; 
        var filterCap = 0; 
        var filterVal; 
        $( ".modalcanvasdiv" ).on('touchend click', function(){
              if (x) clearTimeout(x);
              x = setTimeout(function() {
                    overlayindex++; 
                    if(overlayindex >= overlayImageUrls.length){
                        overlayindex = 0; 
                    }
                    assignCurrentFace(overlayindex);
                    $(".webcamoverlayimage").attr('src', overlayImageUrls[overlayindex]);
                    if( $('.webcamhelpertext').is(':visible')){
                        $('.webcamhelpertext').hide(); 
                    }
                  
                    if(filterCap > 2){
                        filterChangeCounter++; 
                        filterCap = 0; 
                    }
                  
                    if((filterChangeCounter % 3) == 0){
                                         //hue rotate/green filter
                        filterVal = "brightness(250%) hue-rotate(63deg)";
                        $('.webcamvideo').css('filter',filterVal).css('webkitFilter',filterVal);
                     
                    }
                    else if((filterChangeCounter % 3) == 1){
             //saturation filter
                        filterVal = "brightness(250%) saturate(800%)";
                        $('.webcamvideo').css('filter',filterVal).css('webkitFilter',filterVal);
                    }
                    else if((filterChangeCounter % 3) == 2){
                   //normal brightness filter
                        filterVal = "brightness(250%)";
                        $('.webcamvideo').css('filter',filterVal).css('webkitFilter',filterVal);
                    }
                        
                    filterCap++; 
                    y++;
                    //console.log("wtf is y: " + y);
                 // ----------------
              }, 100);
        });  
          
        //retake photo  
        $( ".nobutton" ).on('touchend click', function(){ 
            $(".nobutton").transition({filter: 'invert(100%)' }, 100, 'out', function() {     
                $(".nobutton").transition({filter: 'invert(0%)' }, 100, 'in', function() {    
                    $('.modalcontent').show(); 
                });
            });
        });
        $( ".nobutton" ).hover( 
            function(){  
                $(".nobutton").transition({opacity: .6 }, 100, 'in'); 
            },
            function(){  
                $(".nobutton").transition({opacity: 1.0 }, 100, 'in'); 
            }
        );
          
        
        //photo approved  
        $( ".yesbutton" ).on('touchend click', function(){  
            $(".yesbutton").transition({filter: 'invert(100%)' }, 100, 'out', function() {     
                $(".yesbutton").transition({filter: 'invert(0%)' }, 100, 'in', function() { 
                    //Webcam.reset();
                    var track = localStream.getTracks()[0];
                    track.stop();
                    $(".modaldiv").hide();
                    setTimeout(function() {
                        fullpage.moveSectionDown();
                    }, 500);
                });
            }); 
            
        });
        $( ".yesbutton" ).hover( 
            function(){  
                $(".yesbutton").transition({opacity: 0.6 }, 100, 'in'); 
            },
            function(){  
                $(".yesbutton").transition({opacity: 1.0 }, 100, 'in'); 
            }
        );
        
        //id name
        $( "#closeiconwebcam", "#closeiconapprove" ).on('touchend click', function(){
            //track.stop();
            //Webcam.reset();
            previewFaceImages = []; 
            var track = localStream.getTracks()[0];
            track.stop();
        });
          
          
        //down arrow hovered
        $( ".nextlinkblock" ).hover( 
            function(){  
                $(".nextlinkblock").transition({scale: 1.1 }, 100, 'in'); 
            },
            function(){  
                $(".nextlinkblock").transition({scale: 1.0 }, 100, 'in'); 
            }
        );  
          
        /************DETECT CLICK ANYWHERE********************/  
        var timeDocClick; 
        var lastTimeDocClick = 0;
        $(document).on('touchend click', function(){  
            timeDocClick = new Date().getTime();
            //console.log("time since last click: " + (timenow - lastTime));
            if((timeDocClick - lastTimeDocClick) > 50){
                lastTimeDocClick = new Date().getTime();
                // When the user clicks anywhere on the document
                //console.log("what I clicked: "+$(event.target).attr('class'));
                //close webcam stream
                if ($(event.target).attr('class') == "modaldiv") {
                   // track.stop();
                    //Webcam.reset();
                    var track = localStream.getTracks()[0];
                    track.stop();
                    previewFaceImages = []; 
                    $(".modaldiv").hide();
                }

                if ($(event.target).attr('class') == "hr1") {
                    selectedBody = "leia";

                    $(".hero1link").transition({scale: 1.1 }, 100, 'in', function() {
                        $(".hero1link").transition({ scale: 1.0 }, 150, 'in');
                        $('.hero1link').css('background-color','#666666');
                        $('.hero2link').css('background-color','transparent');
                        $('.hero3link').css('background-color','transparent');
                    }); 
                    setTimeout(function() {
                        fullpage.moveSectionDown();
                    }, 500);

                    console.log("Selected Body: " + selectedBody);
                }
                else if ($(event.target).attr('class') == "hr2") {
                    selectedBody = "luther";
                    $(".hero2link").transition({scale: 1.1 }, 100, 'in', function() {
                        $(".hero2link").transition({ scale: 1.0 }, 150, 'in');
                        $('.hero2link').css('background-color','#666666');
                        $('.hero1link').css('background-color','transparent');
                        $('.hero3link').css('background-color','transparent');
                    }); 
                    console.log("Selected Body: " + selectedBody);
                                        setTimeout(function() {
                        fullpage.moveSectionDown();
                    }, 500);

                }
                else if ($(event.target).attr('class') == "hr3") {
                    selectedBody = "hulk";
                    $(".hero3link").transition({scale: 1.1 }, 100, 'in', function() {
                        $(".hero3link").transition({ scale: 1.0 }, 150, 'in');
                        $('.hero3link').css('background-color','#666666');
                        $('.hero2link').css('background-color','transparent');
                        $('.hero1link').css('background-color','transparent');
                    }); 
                    console.log("Selected Body: " + selectedBody);
                                        setTimeout(function() {
                        fullpage.moveSectionDown();
                    }, 500);

                }
            }

        }); 
          
        $( ".hero1link" ).hover( 
            function(){  
                $(".hero1link").transition({opacity: 0.4 }, 200, 'in'); 
            },
            function(){  
                $(".hero1link").transition({opacity: 1.0 }, 100, 'in'); 
            }
        );  
        $( ".hero2link" ).hover( 
            function(){  
                $(".hero2link").transition({opacity: 0.4 }, 200, 'in'); 
            },
            function(){  
                $(".hero2link").transition({opacity: 1.0 }, 100, 'in'); 
            }
        );  
        $( ".hero3link" ).hover( 
            function(){  
                $(".hero3link").transition({opacity: 0.4 }, 200, 'in'); 
            },
            function(){  
                $(".hero3link").transition({opacity: 1.0 }, 100, 'in'); 
            }
        );  
          
          
        /***********************************************/
        var blinkingCursor;
        var bCursorCounter = 0; 
        $("#name-4").focusin(function() {
            
            
            if(isMobile() == true){
               if(window.innerWidth >200 && window.innerWidth <=600) { /*change the numbers as you see fit*/
		          $("#fakeInputDiv").show(); 
                  blinkingCursor.clearInterval();
                  //if(blinkingCursor != null){
                      blinkingCursor =  setInterval(function(){
                          if((bCursorCounter % 2) == 0 ){ 
                              $("#fakeInput").val(inputText4 + "I");  
                          }else{
                              $("#fakeInput").val(inputText4);  
                          }
                          bCursorCounter++; 
                      }, 400);
                  //}
                   
	           }else{
                   $(".step4input").css({"position": "absolute", "top": "16%", "max-width": "50%"});   
               }
            }
            toggleModal();
            /*setInterval(function(){
                console.log("in focusin");
                window.scrollTo(0, 0);
                document.body.scrollTop = 0;
            }, 50);*/
            
            //fullpage.moveTo(2);
        });
        $("#name-4").focus(function() {
            console.log("in focus");
            window.scrollTo(0, 0);
            document.body.scrollTop = 0;
            //fullpage.moveTo(2);
        });
        $("#name-4").focusout(function() {
           
            if(isMobile() == true){
               if(window.innerWidth >200 && window.innerWidth <=600) { /*change the numbers as you see fit*/
                     $("#fakeInputDiv").hide();   
	           }
               else{
                    $(".step4input").css({"position": "", "top": "", "max-width": ""}); 
               }
            }
            toggleModal();
        });
       
          
     function toggleModal() {
    var offset;
    if (document.body.classList.contains('modal--opened')) {
        offset = parseInt(document.body.style.top, 10);
        document.body.classList.remove('modal--opened');
        document.body.scrollTop = (offset * -1);
    } else {
        offset = document.body.scrollTop;
        document.body.style.top = (offset * -1) + 'px';
        document.body.classList.add('modal--opened');
    }
}
          
       /* $(document).keypress(function(e) {
            if(e.which == 13) {
                alert('You pressed enter!');
                if($("#name-4").is(":focus")){
                    $(".step4input").css({"position": "", "top": "", "max-width": ""});
                }
            }
        });*/
          
          
          
        var tempImages = [];   
        function CreateFacePNGs(){
            var headArray; 
            if(currentface == "leia"){
                headArray = leiahead_images.concat();
            }else if(currentface == "pussyhat"){
                headArray = pussyhathead_images.concat();
            }else if(currentface == "hat"){
                headArray = hathead_images.concat();
            } 
            console.log("HEAD A length: "+ headArray.length);
         
            
            //var baseImage; 
            var faceCanvas = document.createElement('canvas');
            if(previewFaceImages.length == 0){
                faceCanvas.width = blank_heads[0].width;
                faceCanvas.height = blank_heads[0].height;    
            }else{
                faceCanvas.width = widthAvailable;
                faceCanvas.height = heightAvailable;
            }
            
            var fctx = faceCanvas.getContext('2d');
            for (k = 0; k < headArray.length; k++) { 
                //alert("k: " + k)
                /*baseImage = new Image(); 
                baseImage.onload= function(){
                    //iterate through and add png to bare face
                           //setup*/
               
                
                    fctx.clearRect(0, 0, faceCanvas.width,faceCanvas.height);
                        //fctx.drawImage(baseImage, 0 , 0 , baseImage.width, baseImage.height);
                        
                        //if(isMobile()){
                        //    fctx.drawImage(previewFaceImages[k],0 ,0, faceCanvas.width,faceCanvas.height);    
                        //}else{
                            //fctx.drawImage(baseImage,0 ,0, faceCanvas.width, faceCanvas.height);
                //alert("pfi length: " + previewFaceImages.length);
                
                if(previewFaceImages.length == 0){     
                    fctx.drawImage(blank_heads[k],0,0, blank_heads[k].width, blank_heads[k].height, 0,0,blank_heads[k].width, blank_heads[k].height);
                }
                else{
                    fctx.drawImage(previewFaceImages[k],0,0, faceCanvas.width, faceCanvas.height, 0,0,faceCanvas.width, faceCanvas.height);
                }
                            
                       /* var tempCanvas = document.createElement("canvas"),
                        tCtx = tempCanvas.getContext("2d");

                        tempCanvas.width = 463;
                        tempCanvas.height = 369;

                        tCtx.drawImage(faceCanvas,0,0);*/
                
                
                        //}

                        var srcData = faceCanvas.toDataURL('image/png');//tempCanvas.toDataURL('image/png'); //faceCanvas.toDataURL('image/png');
                        var tImage = new Image(); 
                        tImage.src = srcData; 
                        //alert("baseImage w:" + baseImage.width + " h: " + baseImage.height);
                        
                        //allMyFaces.push(blank_heads[k].src);
                        allMyFaces.push(tImage.src);
                
                        //alert("made face png: " + k);
                        if(k == 3){ 
                             //console.log(" png last");
                            GenerateGIF(); 
                        }  
                //};
                //console.log("barefacesrc: " + bareFaceSrc);
                //baseImage.src = bareFaceSrc; 
                //baseImage.src = previewFaceImages[i].src; */
            }
        }  
          
        function changeImageSrc(domImg,src1)
        {
            var img = new Image();
            img.onload = function()
            {
                // Load completed
                domImg.src = this.src;
                //faceImagesLoaded();
            };
            img.src = src1;
        }  
          
        var timenow; 
        var lastTime = 0;  
        //clip the face and show on the approve window
        $( ".photobutton" ).on('touchend click', function(){
            timenow = new Date().getTime();
            if((timenow - lastTime) > 70){
                lastTime = new Date().getTime();
                $(".photobutton").transition({filter: 'invert(100%)' }, 100, 'out', function() {     
                    $(".photobutton").transition({filter: 'invert(0%)' }, 100, 'in', function() { 
                        faceOutlines = [];
                        faceAreas = []; 
                        for (j = 0; j < faces[currentface].clipurl.length; j++) { 
                            var area_image = new Image();
                            area_image.onload = function()
                            {
                                area_image.width = $( ".webcamoverlayimage" ).width();
                                area_image.height = $( ".webcamoverlayimage" ).height();
                                faceImagesLoaded();
                            };
                            area_image.src = faces[currentface].clipurl[j];
                            faceAreas.push(area_image);
                        //}

                        //for (i = 0; i < faces[currentface].pngurl.length; i++) { 
                            var outline = new Image();
                            outline.onload = function()
                            {
                                outline.width = $( ".webcamoverlayimage" ).width();
                                outline.height = $( ".webcamoverlayimage" ).height();
                                faceImagesLoaded();
                            };
                            outline.src = faces[currentface].pngurl[j];
                            faceOutlines.push(outline);
                        }
                    });
                });
            }
        
        });
        $( ".photobutton" ).hover( 
            function(){  
                $(".photobutton").transition({opacity: .6 }, 100, 'in'); 
            },
            function(){  
                $(".photobutton").transition({opacity: 1.0 }, 100, 'in'); 
            }
        );
          
        var faceImageLoadCounter = 0;   
        function faceImagesLoaded(){
            faceImageLoadCounter++;
            if(faceImageLoadCounter >= 8){
                compileFace();
            }
        }
         
        var faceCounter = 0;  
        var previewFaceImages = [];
        function compileFace(){ 
             
            var webvideo = document.getElementById("videoElement");
            xOffset = ($(".webcamoverlayimage").offset().left -$(".modalcontent").offset().left)
            yOffset = $(".webcamoverlayimage").offset().top;
            widthAvailable = $( ".webcamoverlayimage" ).width();
            heightAvailable = $( ".webcamoverlayimage" ).height();
            
            
            wCanvas.width = webvideo.clientWidth; // mWidth; 
            wCanvas.height =  webvideo.clientHeight;// mHeight; 
           // wCanvas.width = webvideo.width; 
            //wCanvas.height = webvideo.height; 
            //wCanvas.width = $( "#videoElement" ).find("video").width();
           // wCanvas.width = widthAvailable;
            //wCanvas.height = $( "#videoElement" ).find("video").height();
            //wCanvas.height = heightAvailable;
            var fctx = wCanvas.getContext('2d');
             fctx.clearRect(0, 0, wCanvas.width, wCanvas.height);
            fctx.translate(wCanvas.width, 0);
            fctx.scale(-1, 1);

            
            //var webvideo  = $( "#videoElement" ).find("video");
            //var webvideo  = document.getElementsByTagName("video")[0];
            
                
            var xCoord = xOffset; //($(".webcamoverlayimage").offset().left -$(".modalcontent").offset().left);
            var yCoord = yOffset;//$(".webcamoverlayimage").offset().top;
            var wcWidth = widthAvailable; //$( ".webcamoverlayimage" ).width();
            var wcHeight = heightAvailable; //$( ".webcamoverlayimage" ).height();
            
            //alert("webcamoverlayimaWIDTH: "+ wcWidth + " webcamoverlayimaHEIGHT: " + wcHeight + " wCanvasWidth: " + wCanvas.width + " wCanvasHeight: " + wCanvas.height );
            
            //alert("xCoord: "+ xCoord + " yCoord: " + yCoord + " wOverlayOffsetLeft: " + $(".webcamoverlayimage").offset().left + " modalContentOffsetLeft: " + $(".modalcontent").offset().left );
            //alert("clipW: " + clip_image.width + " clipH: " + clip_image.height)
            //alert(wcWidth +" w:h: "+wcHeight + " clipH: " + click_image.height);
            //fctx.drawImage(clip_image, 0, 0, clip_image.width, clip_image.height, xCoord, yCoord, clip_image.width, clip_image.height);
             if(faceCounter >= 4){
                    faceCounter = 0; 
                }
            
            //fctx.drawImage(faceAreas[faceCounter], xCoord,  yCoord, wcWidth, wcHeight);
            //alert("webcam width: " + wCanvas.width + " widthAvail: " + wcWidth);
            if(isMobile()){
                fctx.drawImage(faceAreas[faceCounter], 60,  yCoord, wcWidth, wcHeight);    
            }
            else{
                fctx.drawImage(faceAreas[faceCounter], (wCanvas.width - wcWidth)/2,  yCoord, wcWidth, wcHeight);
            }
            /// change composite mode to use that shape
            fctx.globalCompositeOperation = 'source-in';
            
            //Webcam.snap( function() {   
               // alert("wCanvasW: " + wCanvas.width + "wCanvasH: " + wCanvas.height);
                /// draw the image to be clipped
               // fctx.drawImage(webvideo, 0, 0, webvideo.clientWidth, heightAvailable, 0, 0, webvideo.clientWidth, heightAvailable);   
             if (typeof fctx.filter !== "undefined") {
                //fctx.filter = "saturate(800%)";
                 //fctx.filter = "brightness(300%)";
                 if((filterChangeCounter % 3) == 0){
                        //hue rotate/green filter
                        fctx.filter = 'brightness(250%) hue-rotate(63deg)';
                    }
                    else if((filterChangeCounter % 3) == 1){
                          //saturation filter
                        fctx.filter = 'brightness(250%) saturate(800%)';
                    }
                    else if((filterChangeCounter % 3) == 2){
                    
                        //normal brightness filter
                        fctx.filter = 'brightness(250%)';
                    }
             }else{
                 
             }
             
             fctx.drawImage(webvideo, 0, 0, wCanvas.width, wCanvas.height);   
             fctx.globalCompositeOperation = 'source-over';
                /*Filters.brightness = function(pixels, adjustment) {
                      var d = pixels.data;
                      for (var i=0; i<d.length; i+=4) {
                        d[i] += adjustment;
                        d[i+1] += adjustment;
                        d[i+2] += adjustment;
                      }
                      return pixels;
                };*/
                
                //extract bare face to use later. 
                /*var resultCanvas = new ClosePixelation( wCanvas, fctx, [
                    { resolution: 24 },
                    { shape: 'diamond', resolution: 24, offset: 12, alpha: 0.5  },
                    { shape: 'diamond', resolution: 24, offset: 36, alpha: 0.5  },
                    { shape: 'circle', resolution: 8, size: 8, offset: 4, alpha: 0.5 }
                ]);
                fctx.drawImage(resultCanvas, 0,0);*/
                //bareFaceSrc = wCanvas.toDataURL('image/png');
                //var tempSrc = wCanvas.toDataURL('image/png');
                //bareFaceSrc.push(tempSrc);  

               
                fctx.filter = "none";
                //fctx.drawImage(faceOutlines[faceCounter], xCoord,  yCoord, wcWidth, wcHeight);
            if(isMobile()){
                fctx.drawImage(faceOutlines[faceCounter],60,  yCoord, wcWidth, wcHeight);
            }
            else{
                fctx.drawImage(faceOutlines[faceCounter],(wCanvas.width - wcWidth)/2,  yCoord, wcWidth, wcHeight);
            }
                //fctx.drawImage(faceOutlines[faceCounter],0,0, faceCanvas.width, faceCanvas.height, 0,0,faceCanvas.width, faceCanvas.height);
                        var tempCanvas = document.createElement("canvas"),
                        tCtx = tempCanvas.getContext("2d");

                        tempCanvas.width = 600;
                        tempCanvas.height = 450;

                        tCtx.drawImage(wCanvas,0,0);
            
            

                faceSrcData = tempCanvas.toDataURL('image/png');//wCanvas.toDataURL('image/png');
                //faceSrcDataJ = wCanvas.toDataURL('image/jpeg');
                //alert(faceSrcData);
                //faceImage.onload = faceImageLoaded;
               /* faceImage.onload = function(){
                    $('.modalcontent').hide();
                    $(".approveimage").attr('src', faceSrcData); 
                };*/
               // var apImage = $(".approveimage");
                //if(faceSrcData.length > 100){}
                //var apImage = document.getElementById('approveimg');
                var apImage; 

                if(faceCounter == 0){
                    apImage = document.getElementById('p1');    
                }else if(faceCounter == 1){
                    apImage = document.getElementById('p2');    
                }else if(faceCounter == 2){
                    apImage = document.getElementById('p3');    
                }else if(faceCounter == 3){
                    apImage = document.getElementById('p4');    
                }
                faceCounter++;
                
                 apImage.onload = function()
                 {
                     
                     if(faceCounter >= 4){
                         var target = document.getElementById('spinnerParent');
                        $("#spinnerParent").show();
                        opts = {
                                  lines: 10 // The number of lines to draw
                                , length: 28 // The length of each line
                                , width: 16 // The line thickness
                                , radius: 42 // The radius of the inner circle
                                , scale: 1 // Scales overall size of the spinner
                                , corners: 1 // Corner roundness (0..1)
                                , color: '#ffffff' // #rgb or #rrggbb or array of colors
                                , opacity: 0.25 // Opacity of the lines
                                , rotate: 0 // The rotation offset
                                , direction: 1 // 1: clockwise, -1: counterclockwise
                                , speed: 1 // Rounds per second
                                , trail: 60 // Afterglow percentage
                                , fps: 20 // Frames per second when using setTimeout() as a fallback for CSS
                                , zIndex: 2e9 // The z-index (defaults to 2000000000)
                                , className: 'spinner' // The CSS class to assign to the spinner
                                , top: '50%' // Top position relative to parent
                                , left: '50%' // Left position relative to parent
                                , shadow: false // Whether to render a shadow
                                , hwaccel: false // Whether to use hardware acceleration
                                , position: 'absolute' // Element positioning
                                }
                        spinner = new Spinner(opts).spin(target); 
                        GiffyfyFaces(previewFaceImages); 
                       
                     }
                 };
                
                apImage.src = faceSrcData;//wCanvas.toDataURL('image/jpeg');//faceSrcData;
                previewFaceImages.push(apImage);
                
                
               // apImage.attr("src", faceSrcData);
                faceImageLoadCounter = 0;   
        
                faceImage.src = faceSrcData; 
                
             
                //var img = document.getElementById('approveimg');


           // }, wCanvas );
        }
          
        function GiffyfyFaces(frames){
         
                gifshot.createGIF({
                    images: frames,
                    gifWidth: 463, 
                    gifHeight: 369, 
                    interval: 0.2
                }, function(obj) {
                    if(!obj.error) {
                        console.log("making the face GIF"); 
                        $('.modalcontent').hide();
                        var image = obj.image;
                        document.getElementById('approveimg').src = image;
                        $("#spinnerParent").hide();
                        spinner.stop(); 
                    }
                });

        }  
          
        
        var words = []; 
        function GenerateGIF(){
            //console.log("great in g g");
            gifFrames = [];
            var idleArray;
            var jabArray; 
            var punchArray; 
            var headPos = { x:5, y: 116};
                  var headSize = {w: 275, h: 206.45 };

            if(selectedBody == "leia"){
                idleArray = leiaidle_images.concat(); 
                jabArray = leiajab_images.concat();
                punchArray = leiapunch_images.concat();
                //5, 0
                headPos = { x:5, y: 0};
                headSize = {w: 337, h: 253 };
            }else if(selectedBody == "luther"){
                idleArray = lutheridle_images.concat(); 
                jabArray = lutherjab_images.concat();
                punchArray = lutherpunch_images.concat();
                  //71, -51
                headPos = { x:93, y: -21};
            }else if(selectedBody == "hulk"){
                idleArray = hulkidle_images.concat(); 
                jabArray = hulkjab_images.concat();
                punchArray = hulkpunch_images.concat();
            //-21, -40
                headPos = { x:8, y: -20};
            } 
                    
            
            /*
             for (j = 0; j < idleArray.length; j++) { 
                    
                    var tempCanvas = document.createElement('canvas');
                    tempCanvas.width = 600;
                    tempCanvas.height = 450;
                    var ctx= tempCanvas.getContext("2d");
                    ctx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                    
                    var hcan = document.createElement('canvas');
                    hcan.width = tempCanvas.width;
                    hcan.height = tempCanvas.height;
                    var hctx = hcan.getContext('2d');
                    
                    //clear the heading canvas
                    hctx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                    hctx = hcan.getContext("2d");
                    //hctx.textAlign = "center";
                        
                    ctx.drawImage(idleArray[j], 0, 0);
                    
                    var hRatio = tempCanvas.width/faceImage.width;
                    var vRatio = tempCanvas.height/faceImage.height;
                    var ratio  = Math.min( hRatio, vRatio );
                    
                    var tempImage = new Image(); 
                    tempImage.onload = function(){
                               //5 ,116,334, 251 LEIA
                    //-21 ,47,337, 253 HULK
                    //71 ,50,337, 253 LUTHER
                    ctx.drawImage(tempImage, 0,0, tempImage.width, tempImage.height, headPos.x ,headPos.y,337, 253);  
                    
                    //hctx.drawImage(click_images[j], 0,0);
                    //ctx.drawImage(hcan, 0,0);
                 
                    var imgData = tempCanvas.toDataURL('image/jpeg');
                    var oneImage = new Image();
                    oneImage.src = imgData;
                    // gifFrames.length = 0; 
                    gifFrames.push(oneImage);
                    };
                 //alert("url: " + head_urls[j]);
                    //if(allMyFaces.length === 0){
                        tempImage.src = "assets/FinalArt/LeiaHead/head_0006_Layer-1.png";//blank_heads[j].src; 
                    //}else{
                    //    tempImage.src = allMyFaces[j];     
                    //}
                    
             
            }*/
            
            var faceCounter = 0; 
            words.length = 0;
            inputText4 = inputText4.toUpperCase();
            words = inputText4.split(" ");
            var punchArrayLength = 0; 
            for(k=0; k < (words.length); k++){
                if(k < (words.length-1)){
                    punchArrayLength = 4; 
                }
                else if(k == (words.length-1)){
                    punchArrayLength = punchArray.length; 
                }
                for (i = 0; i < punchArrayLength; i++) { 
                    
                    var tempCanvas = document.createElement('canvas');
                    tempCanvas.width = 600;
                    tempCanvas.height = 450;
                    var ctx= tempCanvas.getContext("2d");
                    ctx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                    
                    var hcan = document.createElement('canvas');
                    hcan.width = tempCanvas.width;
                    hcan.height = 150;
                    var hctx = hcan.getContext('2d');
                    
                    //clear the heading canvas
                    hctx.clearRect(0, 0, tempCanvas.width, hcan.height);
                    hctx = hcan.getContext("2d");
                    hctx.font = "60px Oswald";
                    hctx.fillStyle = "white";
                    hctx.textAlign = "center";
                    //hctx.fillText(words[k],.68*hcan.width,hcan.height/2);
                    demoShadowEffects();
                    /// Neon light text-effect
                    
                    var shadowStyles = {	
	"Neon": {
		color: "#FFF",
		background: "transparent",
		shadow: "0 0 10px #fff, 0 0 20px #fff, 0 0 30px #fff, 0 0 40px #ff00de, 0 0 70px #ff00de, 0 0 80px #ff00de, 0 0 100px #ff00de, 0 0 150px #ff00de"
	}

};
function demoShadowEffects() {
	function parseShadow(shadows) {
		shadows = shadows.split(", ");
		var ret = [];
		for (var n = 0, length = shadows.length; n < length; n ++) {
			var shadow = shadows[n].split(" ");
			var type = shadow[0].replace(parseFloat(shadow[0]), "");
			if (type == "em") {
				var obj = {
					x: metrics.em * parseFloat(shadow[0]),
					y: metrics.em * parseFloat(shadow[1])
				};
			} else {
				var obj = {
					x: parseFloat(shadow[0]),
					y: parseFloat(shadow[1])
				};
			}
			if (shadow[3]) {
				obj.blur = parseFloat(shadow[2]);
				obj.color = shadow[3];
			} else {
				obj.blur = 0;
				obj.color = shadow[2];		
			}
			ret.push(obj);
		}
		return ret;
	};
	hctx.save();
	hctx.font = "80px Oswald";
	// absolute position of the text (within a translation state)
	var offsetX = .68*hcan.width;
	var offsetY = hcan.height/2;
	// gather information about the height of the font
	var metrics = getMetrics("thequickbrownfox", hctx.font);
	var textHeight = metrics.height * 1.20;
	// loop through text-shadow based effects
	for (var text in shadowStyles) {
		var width = hctx.measureText(words[k]).width;
		var style = shadowStyles[text];
		// add a background to the current effect
		//hctx.fillStyle = style.background;
		//hctx.fillRect(0, offsetY, hctx.canvas.width, textHeight - 1)
		// parse text-shadows from css
		var shadows = parseShadow(style.shadow);
		// loop through the shadow collection
		var n = shadows.length; while(n--) {
			var shadow = shadows[n];
			var totalWidth = width + shadow.blur * 2;
			hctx.save();
			hctx.beginPath();
            //console.log("totalwidth: " + totalWidth);
			hctx.rect(offsetX - (totalWidth/2), offsetY-75, offsetX + totalWidth-(totalWidth), textHeight);
			hctx.clip();
			if (shadow.blur) { // just run shadow (clip text)
				hctx.shadowColor = shadow.color;
				hctx.shadowOffsetX = shadow.x + totalWidth;
				hctx.shadowOffsetY = shadow.y;
				hctx.shadowBlur = shadow.blur;
				hctx.fillText(words[k], -totalWidth + offsetX, offsetY + metrics.top);
			} else { // just run pseudo-shadow
				hctx.fillStyle = shadow.color;
				//hctx.fillText(words[k], offsetX + (shadow.x||0), offsetY - (shadow.y||0) + metrics.top);
			}
			hctx.restore();
		}
		// drawing the text in the foreground
		if (style.color) {
            //if(drawOnce == false){
			     hctx.fillStyle = style.color;
                hctx.fillText(words[k], offsetX, offsetY + metrics.top);
            //}
		}
		// jump to next em-line
		hctx.translate(0, textHeight);
	}
	hctx.restore();
};
                    
                    function getBlurValue(blur) {
	var userAgent = navigator.userAgent;
	if (userAgent && userAgent.indexOf('Firefox/4') != -1) {
		var kernelSize = (blur < 8 ? blur / 2 : Math.sqrt(blur * 2));
		var blurRadius = Math.ceil(kernelSize);
		return blurRadius * 2;
	}
	return blur;
};
              

            function getMetrics(text, font) {
                
                function createInterlace (size, color1, color2) {
	var proto = document.createElement("canvas").getContext("2d");
	proto.canvas.width = size * 2;
	proto.canvas.height = size * 2;
	proto.fillStyle = color1; // top-left
	proto.fillRect(0, 0, size, size);
	proto.fillStyle = color2; // top-right
	proto.fillRect(size, 0, size, size);
	proto.fillStyle = color2; // bottom-left
	proto.fillRect(0, size, size, size);
	proto.fillStyle = color1; // bottom-right
	proto.fillRect(size, size, size, size);
	var pattern = proto.createPattern(proto.canvas, "repeat");
	pattern.data = proto.canvas.toDataURL();
	return pattern;
};
                var op_8x8 = createInterlace(8, "#FFF", "#eee");
                                    var image = document.createElement("img");
image.width = 42;
image.height = 1;
image.src = op_8x8.data;
image.style.cssText = "display: inline";
	var metrics = document.getElementById("metrics");
	if (metrics) {	
		metrics.style.cssText = "display: block";
		var parent = metrics.firstChild;
		parent.firstChild.textContent = text;
	} else {
		// setting up html used for measuring text-metrics
		var parent = document.createElement("span");
		parent.appendChild(document.createTextNode(text));
		parent.appendChild(image);
		var metrics = document.createElement("div");
		metrics.id = "metrics";
		metrics.appendChild(parent);
		document.body.insertBefore(metrics, document.body.firstChild);
	}
	
	// direction of the text
	var direction = window.getComputedStyle(document.body, "")["direction"];

	// getting css equivalent of ctx.measureText()
	parent.style.cssText = "font: " + font + "; white-space: nowrap; display: inline;";
	var width = parent.offsetWidth;
	var height = parent.offsetHeight;

	// capturing the "top" and "bottom" baseline
	parent.style.cssText = "font: " + font + "; white-space: nowrap; display: block;";
	var top = image.offsetTop;
	var bottom = top - height;

	// capturing the "middle" baseline
	parent.style.cssText = "font: " + font + "; white-space: nowrap; line-height: 0; display: block;";
	var middle = image.offsetTop + 1;
	
	// cleanup
	metrics.style.display = "none";

	return {
		direction: direction,
		top: top,
		middle: middle,
		bottom: bottom,
		height: height,
		width: width
	};
};
                    //Pointer canvas
                    /*var pcan = document.createElement('canvas');
                    pcan.width = tempCanvas.width;
                    pcan.height = tempCanvas.height;
                    var pctx = pcan.getContext('2d');
                    pctx.clearRect(0, 0, tempCanvas.width, hcan.height);*/
                    
                   
                    ctx.drawImage(punchArray[i], 0, 0);
                    
                    var hRatio = tempCanvas.width / faceImage.width;
                    var vRatio = tempCanvas.height / faceImage.height;
                    var ratio  = Math.min ( hRatio, vRatio );
                    
                    
                    //5 ,116,334, 251 LEIA
                    //-21 ,47,337, 253 HULK
                    //71 ,50,337, 253 LUTHER
                    if(selectedBody == "luther"){
                                      if(i == 0){
                            //headPos = { x:123, y: -74};
                             headPos = { x:143, y: -54};
                        }else if(i == 1){
                            //headPos = { x:147, y: -56};
                            headPos = { x:167, y: -36};
                        }else if(i == 2){
                            //headPos = { x:123, y: -74};
                            headPos = { x:143, y: -54};
                        }
                        else{
                            //headPos = { x:71, y: -50};  
                          headPos = { x:91, y: -30};  
                        }
                    }
                    
                    
                    
                    faceCounter++;
                    if(faceCounter == 4){
                        faceCounter = 0; 
                    }
                    
                    var tempImage = new Image(); 
                    tempImage.onload = function(){
                        
                    };
                    //tempImage.src = head_urls[faceCounter]; 
        //alert(allMyFaces.length);
                    if(previewFaceImages.length == 0){
                        tempImage.src = head_urls[faceCounter]; 
                    }else{

                        tempImage.src = allMyFaces[faceCounter];     
                   }
                    
                    ctx.drawImage(tempImage, 0,0, tempImage.width, tempImage.height, headPos.x ,headPos.y,headSize.w, headSize.h);    
                    if(i != 0){
                        ctx.drawImage(hcan, 0,0);
                    }
                        //clear the heading canvas
                   /* pctx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                    pctx = pcan.getContext("2d");
                    if(faceCounter == 0 && k != (words.length-1)){
                        //click
                       // pctx.drawImage(click_images[2], 0,0);
                    }else{
                        //no click
                        //pctx.drawImage(click_images[1], 0,0);
                    }*/
                    
                    //ctx.drawImage(pcan, 0,0);
                    
                    var imgData = tempCanvas.toDataURL('image/jpeg');
                    var oneImage = new Image();
                    oneImage.src = imgData;
                    // gifFrames.length = 0; 
                    gifFrames.push(oneImage);
                    if(i == (punchArray.length-1)){
                        //console.log("ALLFACES: " + allMyFaces); 
                        Giffyfy();   
                    } 
                }
            }
            
        } 
    
    
   // });   
        //Make the Summary GIF
          
        $( "#createButton" ).hover( 
            function(){  
                $("#createButton").transition({opacity: 0.4 }, 200, 'in'); 
            },
            function(){  
                $("#createButton").transition({opacity: 1.0 }, 100, 'in'); 
            }
        );
        var timeCreateClick; 
        var lastTimeCreateClick = 0;  
        $('#createButton').on('touchend click' , function(){
            
            timeCreateClick = new Date().getTime();
            //console.log("time since last click: " + (timenow - lastTime));
            if((timeCreateClick - lastTimeCreateClick) > 50){
                lastTimeCreateClick = new Date().getTime();
                $("#createButton").transition({scale: 1.15 }, 100, 'out', function() {     
                    $("#createButton").transition({scale: 1.0 }, 200, 'in', function() {    
                        CreateFacePNGs(); 

                        opts = {
                          lines: 10 // The number of lines to draw
                        , length: 28 // The length of each line
                        , width: 16 // The line thickness
                        , radius: 42 // The radius of the inner circle
                        , scale: 1 // Scales overall size of the spinner
                        , corners: 1 // Corner roundness (0..1)
                        , color: '#ffffff' // #rgb or #rrggbb or array of colors
                        , opacity: 0.25 // Opacity of the lines
                        , rotate: 0 // The rotation offset
                        , direction: 1 // 1: clockwise, -1: counterclockwise
                        , speed: 1 // Rounds per second
                        , trail: 60 // Afterglow percentage
                        , fps: 20 // Frames per second when using setTimeout() as a fallback for CSS
                        , zIndex: 2e9 // The z-index (defaults to 2000000000)
                        , className: 'spinner' // The CSS class to assign to the spinner
                        , top: '50%' // Top position relative to parent
                        , left: '50%' // Left position relative to parent
                        , shadow: false // Whether to render a shadow
                        , hwaccel: false // Whether to use hardware acceleration
                        , position: 'absolute' // Element positioning
                        }
                       var target = document.getElementById('spinnerParent');
                       $("#spinnerParent").show();
                       spinner = new Spinner(opts).spin(target);    
                    });
                }); 
           
            }
            
        });  
    
          
          //PRAVEEN's stuff starts here
        function uploadContent(){

            //First make the data structure to pass to mongo
            var playloop_dict = {};

            playloop_id = generateUUID();
            playloop_dict['scene_name'] = 'AngerTranslator_001';
            playloop_dict['_id'] = playloop_id;
            playloop_dict['playloop_url'] = PLAYLOOPS_SERVER_URL + '/view/' + playloop_id;

            playloop_dict['text1'] = inputText1;
            playloop_dict['text2'] = inputText4;
            playloop_dict['heroname'] = selectedBody;

            var faces_arr = [];
            var promise_arr = [];
            var blah = [];

            //getall signed requests -> upload to s3 -> get signed request summary -> upload s3 summary -> add playloop

            imageType = "png";
            contentType = "image/" + imageType;
            var faces_s3_promises = allMyFaces.map(
                (currElement, index) => {
                    img_id = generateUUID();
                    img_name = img_id + '.' + imageType;
                    return getS3SignedResponse(img_name, contentType);
                 }
            );

            //first get s3 signatures for PNGs
            Promise.all( faces_s3_promises
            ).then( function (s3_signs) {

                //index all the urls and then
                //upload all the face PNGs
                for (var i=0; i< s3_signs.length; i++){
                    faces_arr[i] = s3_signs[i].url;
                }

                console.log(faces_arr);
                playloop_dict['face_imgs'] = faces_arr;

                return Promise.all(
                        allMyFaces.map(
                            (currElement, index) => {
                                uploadFileToS3( allMyFaces[index],
                                        contentType,
                                        s3_signs[index].signedRequest );
                            }
                        )
                    );
                }
            ).then( function ( s3_results ) {
                    //get the summary image signature
                    imageType = "gif";
                    contentType = "image/" + imageType;           
                    img_name = playloop_id + ".gif";
                    return getS3SignedResponse(img_name, contentType);
                }
            ).then( function( signed_response ) {
                    //upload the summary image
                    var signedRequest = signed_response.signedRequest;
                    var summary_url = signed_response.url;

                    imageType = "gif";
                    contentType = "image/" + imageType;

                    console.log("summary_url" + summary_url);
                    playloop_dict['summary_img'] = summary_url;

                    var file = $(".previewimage").attr("src");

                    return uploadFileToS3( file , contentType, signedRequest );

                }
            ).then ( function( s3_results) {
                    //save the playloop datastructure
                    return  addPlayloop (playloop_dict);

                }
            ).then ( function ( data ) {
                    //finally redirect here
                    $("#spinnerParent").hide();
                    spinner.stop(); 
                    console.log("*** Finished image uploads: " + playloop_dict['playloop_url'])
                    //return $.get(playloop_dict['playloop_url']);
                    window.location.href = playloop_dict['playloop_url'];
                }
            );
    }
    //PRAVEEN's stuff ends here  
  
     function Giffyfy(){
         
                gifshot.createGIF({
                    images: gifFrames,
                    gifWidth: 600, 
                    gifHeight: 450, 
                    interval: 0.2
                }, function(obj) {
                    if(!obj.error) {
                        console.log("making hte GIF"); 
                        var image = obj.image;
                        $('.previewfootersection').show(); 
                        document.getElementById('previewimage').src = image;
    
                        uploadContent(); 
                    }
                });

      }
    
    

       
    });
                        
     //}
  </script>    
  <!-- [if lte IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif] -->
</body>
</html>