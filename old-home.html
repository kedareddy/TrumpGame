<!DOCTYPE html>
<!--  This site was created in Webflow. http://www.webflow.com -->
<!--  Last Published: Sun Jan 15 2017 09:20:59 GMT+0000 (UTC)  -->
<html class="oldhomehtml" data-wf-page="5875327699546d416a201491" data-wf-site="5875327699546d416a201490">
<head>
  <meta charset="utf-8">
  <title>AngerTranslator</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="Webflow" name="generator">

    
    
    
    
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/angertranslator.webflow.css" rel="stylesheet" type="text/css">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js"></script>
    
  <script type="text/javascript">
    WebFont.load({
      google: {
        families: ["Montserrat:400,700","Oswald:300,400,700"]
      }
    });
  </script>
  <script src="js/modernizr.js" type="text/javascript"></script>
  <link href="https://daks2k3a4ib2z.cloudfront.net/img/favicon.ico" rel="shortcut icon" type="image/x-icon">
  <link href="https://daks2k3a4ib2z.cloudfront.net/img/webclip.png" rel="apple-touch-icon">
    
    
    <script type="text/javascript" src="js/libgif.js"></script>
    <script src='js/gifshot.min.js'></script>
    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.js"></script>-->
    
    <!--<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>-->
    
    
    
    <link rel="stylesheet" type="text/css" href="js/javascript.fullPage.css" />
    <script type="text/javascript" src="js/javascript.fullPage.min.js"></script>
    
    <!-- load that lib -->
    <script src="js/playloops.js"></script>
    <script src="js/close-pixelate.js"></script>
    
    <!--webcamjs libraries -->
    <script src="js/webcam.js"></script>
    <script src="js/webcam.swf"></script>
    
    <script src="js/spin.min.js"></script>

    
</head>
<body class="oldhomebody" id="thebody">
    <!-- -->
<div id="spinnerParent" style="position:absolute;z-index:500;display:none; height:100%; width:100%; background-color:rgba(0, 0, 0, 0.8);"></div>    
  <div class="modaldiv" data-ix="displaynoneonload">
    <!--<div class="modalcontentwrapper">-->
        <div class="modalcontent">
            <!-- data-ix="closemodal" -->
          <div class="modalclosediv"  data-ix="closemodal" ><img class="closeicon" id="closeiconwebcam" src="images/VisualEditor_-_Icon_-_Close-01.svg">
          </div>
          <div class="modalcanvasdiv">
            <h1 class="webcamhelpertext">Click To Change Filter</h1>
            <img class="webcamoverlayimage" src="assets/FinalArt/LeiaHead.gif">
              <!-- <div autoplay="true" class="webcamvideo" id="videoElement"></div> -->
            <div class="webcamvideo" id="videoElement"></div> 
            <canvas class="webcamcanvas" id="webcamcanvas"></canvas>
          </div>
          <div class="modalcameradiv"><img class="photobutton" src="images/cricle.png">
          </div>
        </div>
   <!-- </div>  -->
    <div class="modalapprovecontent">
      <div class="modalclosediv"  data-ix="closemodal" ><img class="closeicon" id="closeiconapprove" src="images/VisualEditor_-_Icon_-_Close-01.svg">
      </div>
      <div class="modalcanvasdiv">
        <h1 class="approvehelpertext">Click To Change Filter</h1>
        <img class="approveimage" id="approveimg" src="assets/FinalArt/LeiaHead.gif">
      </div>
      <div class="modalyesno">
        <div class="modalyes" ><img class="yesbutton" src="images/choices-01.svg" data-theme="b" data-textonly="false" data-textvisible="true" data-msgtext="Loading theme b" data-inline="true">
        </div>
        <div class="modalno"><img class="nobutton" src="images/choices-02.svg">
        </div>
      </div>
    </div>
  </div>
  <div class="headersection">
    <div class="w-container">
      <div class="headerdiv">
        <!--<h1 class="logoheading">Play Loops</h1>-->
           <img class="logoheading" src="images/bluelogo.svg">  
      </div>
    </div>
  </div>
  <div id="fullpage">
 <!-- <div class="section mostsections hiddensection">
    <div class="w-container">
      <div class="mosteditordivs">
        <div class="stepformwrapper w-form">
          <form class="formdiv" onsubmit="step1Submit()" data-name="Email Form" data-redirect="javascript:void(0);" id="email-form" name="email-form" redirect="javascript:void(0);">
            <div class="stepnumdiv">
              <h1 class="stepnumber">1.</h1><img class="stepnumicon" src="images/symbols-1.svg">
            </div>
            <div class="stepinputdiv">
              <label class="step1title" for="name">I am...</label>
              <input class="step1input1 w-input" data-name="Name" id="name" maxlength="20" name="name" placeholder="Who are you? " type="text">
            </div>
            <div class="stepbutton">
              <a class="w-inline-block" href="#Step2"><img class="nextlinkblock" src="images/25243.svg">
              </a>
            </div>
          </form>
          <div class="w-form-done">
            <div>Thank you! Your submission has been received!</div>
          </div>
          <div class="w-form-fail">
            <div>Oops! Something went wrong while submitting the form</div>
          </div>
        </div>
      </div>
    </div>
  </div> -->
<section class="section mostsections" id="SectionStep1">
    <div class="w-container">
      <div class="mosteditordivs">
        <div class="stepformwrapper w-form">
          <form class="formdiv" data-name="Email Form" id="email-form" name="email-form">
            <div class="stepnumdiv">
              <h1 class="stepnumber">1.</h1><img class="stepnumicon" src="images/symbols-1.svg">
            </div>
            <div class="stepinputdiv">
              <label class="step3title" for="name-3">Choose Your Hero!</label>
              <div class="step3heroesdiv">
                <a class="hero1link w-inline-block" href="#"><img class="hr1" src="images/Leia SVG.svg">
                </a>
                <a class="hero2link w-inline-block" href="#"><img class="hr2" src="images/Luther SVG.svg">
                </a>
                <a class="hero3link w-inline-block" href="#"><img class="hr3" src="images/Hulk SVG.svg">
                </a>
                <a class="hero4link w-inline-block" href="#"><img class="hr4" src="images/Person_icon_BLACK-01.svg">
                </a>
              </div>
            </div>
            <div class="stepbutton three">
              <a class="w-inline-block" href="#Step2"><img class="nextlinkblock" src="images/25243.svg">
              </a>
            </div>
          </form>
          <div class="w-form-done">
            <div>Thank you! Your submission has been received!</div>
          </div>
          <div class="w-form-fail">
            <div>Oops! Something went wrong while submitting the form</div>
          </div>
        </div>
      </div>
    </div>
  </section>      
  <section class="section mostsections" id="SectionStep2">
    <div class="mostcontainers w-container">
      <div class="mosteditordivs">
        <div class="stepformwrapper w-form">
          <form class="formdiv" data-name="Email Form" id="email-form" name="email-form">
            <div class="stepnumdiv">
              <h1 class="stepnumber">2.</h1><img class="stepnumicon" src="images/symbols-1.svg">
            </div>
            <div class="step2 stepinputdiv">
              <div class="step2selfiediv">
                <label class="step2title" for="name-2">Add Your Face!</label>
                <a class="w-inline-block" ><img class="step2icon" src="images/camera.svg">
                </a>
              </div>
              <div class="step2or">
                <h1 class="step2ortext">or</h1>
              </div>
              <div class="step2uploaddiv">
                <label class="step2title" for="name-2">Upload</label>
                <a class="w-inline-block" ><img class="step2icon upload" src="images/camera.svg">
                </a>
              </div>
            </div>
            <div class="stepbutton two">
              <a class="w-inline-block" href="#Step3"><img class="nextlinkblock" src="images/25243.svg">
              </a>
            </div>
          </form>
          <div class="w-form-done">
            <div>Thank you! Your submission has been received!</div>
          </div>
          <div class="w-form-fail">
            <div>Oops! Something went wrong while submitting the form</div>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <section class="section mostsections" id="SectionStep3">
    <div class="w-container">
      <div class="mosteditordivs">
        <div class="stepformwrapper w-form">
          <form class="formdiv" onsubmit="step4Submit()" data-name="Email Form" data-redirect="javascript:void(0);" id="email-form" name="email-form" redirect="javascript:void(0);">
            <div class="stepnumdiv">
              <h1 class="stepnumber">3.</h1><img class="stepnumicon" src="images/symbols-1.svg">
            </div>
            <div class="stepinputdiv 4" id="step4inputdiv">
              <label class="step4title" for="name-4">Your Message To Trump</label>
              <input class="step4input w-input" data-name="Name 4" id="name-4" maxlength="256" name="name-4" placeholder="NOT MY PRESIDENT" type="text">
            </div>
            <div class="four stepbutton"><a class="submitbutton w-button" href="index.html"  id="createButton" onclick='return false;'>CREATE</a>
            </div>
          </form>
          <div class="w-form-done">
            <div>Thank you! Your submission has been received!</div>
          </div>
          <div class="w-form-fail">
            <div>Oops! Something went wrong while submitting the form</div>
          </div>
        </div>
      </div>
    </div>
  </section>
  </div>
  <div class="mostsections">
    <div class="extraspacecontainer w-container">
      <div class="last mosteditordivs"></div>
    </div>
  </div>
  <div class="previewfootersection" data-ix="displaynoneonload" >
    <div class="previewfootercontainer w-container">
      <div class="previewfooterdiv">
        <h1 class="footertext">I am<br>Asian American</h1><img class="previewimage" id="previewimage" src="images/LEIA_IDLE_INK.gif">
      </div>
    </div>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js" type="text/javascript"></script>
  <script src="js/webflow.js" type="text/javascript"></script>

    <script src='js/jquery.transit.js'></script>
    

<script type="text/javascript">
    //var testImage = new Image();
    var spinner;   
    var heightAvailable; 
    var widthAvailable;
    var xOffset; 
    var yOffset; 
    var bareFaceSrc; 
    var gifFrames = []; 
    var allMyFaces = []; 
    var faceSrcData;
    var faceImage = new Image(); 
    var inputText1 = "I am American";
    var inputText4 = "He is not my president"; 
    //testImage.src = 'assets/Test/LEIA_IDLE_INK.gif'; 
    var isMobile;
    //timeout variables
    var x, y = 1;
    var click_urls = ['images/click/click_0003_Layer-1.png','images/click/click_0002_Layer-2.png', 'images/click/click_0001_Layer-3.png', 'images/click/click_0000_Layer-4.png'];
    var click_images = [];
    for (a = 0; a < click_urls.length; a++) {
        click_images[a] = new Image();
        click_images[a].src = click_urls[a];
    }
    
    var leiaidle_urls = ['assets/FinalArt/LeiaIdle/Idle_0003_Layer 1.jpg','assets/FinalArt/LeiaIdle/Idle_0002_Layer 2.jpg', 'assets/FinalArt/LeiaIdle/Idle_0001_Layer 3.jpg', 'assets/FinalArt/LeiaIdle/Idle_0000_Layer 4.jpg'];
    var leiajab_urls = ['assets/FinalArt/LeiaJab/Jab_0003_Layer 1.jpg','assets/FinalArt/LeiaJab/Jab_0002_Layer 2.jpg', 'assets/FinalArt/LeiaJab/Jab_0001_Layer 3.jpg', 'assets/FinalArt/LeiaJab/Jab_0000_Layer 4.jpg'];
    var leiapunch_urls = [ 
                          'assets/FinalArt/LeiaPunch/Punch_0012_Layer 3.jpg', 
                          'assets/FinalArt/LeiaPunch/Punch_0011_Layer 4.jpg',
                          'assets/FinalArt/LeiaPunch/Punch_0010_Layer 5.jpg',
                          'assets/FinalArt/LeiaPunch/Punch_0009_Layer 6.jpg',
                          'assets/FinalArt/LeiaPunch/Punch_0008_Layer 7.jpg',
                          'assets/FinalArt/LeiaPunch/Punch_0007_Layer 8.jpg',
                          'assets/FinalArt/LeiaPunch/Punch_0006_Layer 9.jpg',
                          'assets/FinalArt/LeiaPunch/Punch_0005_Layer 10.jpg',
                          'assets/FinalArt/LeiaPunch/Punch_0004_Layer 11.jpg',
                          'assets/FinalArt/LeiaPunch/Punch_0003_Layer 12.jpg',
                          'assets/FinalArt/LeiaPunch/Punch_0002_Layer 13.jpg',
                          'assets/FinalArt/LeiaPunch/Punch_0001_Layer 14.jpg',
                         ];
    var leiaidle_images = [];
    for (i = 0; i < leiaidle_urls.length; i++) {
        leiaidle_images[i] = new Image();
        leiaidle_images[i].src = leiaidle_urls[i];
    }
    var leiajab_images = [];
    for (j = 0; j < leiajab_urls.length; j++) {
        leiajab_images[j] = new Image();
        leiajab_images[j].src = leiajab_urls[j];
    }
    var leiapunch_images = [];
    for (k = 0; k < leiapunch_urls.length; k++) {
        leiapunch_images[k] = new Image();
        leiapunch_images[k].src = leiapunch_urls[k];
    }
    
    var lutheridle_urls = ['assets/FinalArt/LutherIdle/Idle_0003_Layer 1.jpg','assets/FinalArt/LutherIdle/Idle_0002_Layer 2.jpg', 'assets/FinalArt/LutherIdle/Idle_0001_Layer 3.jpg', 'assets/FinalArt/LutherIdle/Idle_0000_Layer 4.jpg'];
    var lutherjab_urls = ['assets/FinalArt/LutherJab/Jab_0003_Layer 1.jpg','assets/FinalArt/LutherJab/Jab_0002_Layer 2.jpg', 'assets/FinalArt/LutherJab/Jab_0001_Layer 3.jpg', 'assets/FinalArt/LutherJab/Jab_0000_Layer 4.jpg'];
    var lutherpunch_urls = ['assets/FinalArt/LutherPunch/Punch_0014_Layer 1.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0013_Layer 2.jpg', 
                          'assets/FinalArt/LutherPunch/Punch_0012_Layer 3.jpg', 
                          'assets/FinalArt/LutherPunch/Punch_0011_Layer 4.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0010_Layer 5.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0009_Layer 6.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0008_Layer 7.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0007_Layer 8.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0006_Layer 9.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0005_Layer 10.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0004_Layer 11.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0003_Layer 12.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0002_Layer 13.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0001_Layer 14.jpg',
                         ];
    var lutheridle_images = [];
    for (l = 0; l < lutheridle_urls.length; l++) {
        lutheridle_images[l] = new Image();
        lutheridle_images[l].src = lutheridle_urls[l];
    }
    var lutherjab_images = [];
    for (m = 0; m < leiajab_urls.length; m++) {
        lutherjab_images[m] = new Image();
        lutherjab_images[m].src = lutherjab_urls[m];
    }
    var lutherpunch_images = [];
    for (n = 0; n < lutherpunch_urls.length; n++) {
        lutherpunch_images[n] = new Image();
        lutherpunch_images[n].src = lutherpunch_urls[n];
    }
    
    
    var hulkidle_urls = ['assets/FinalArt/HulkIdle/Idle_0003_Layer 1.jpg','assets/FinalArt/HulkIdle/Idle_0002_Layer 2.jpg', 'assets/FinalArt/HulkIdle/Idle_0001_Layer 3.jpg', 'assets/FinalArt/HulkIdle/Idle_0000_Layer 4.jpg'];
    var hulkjab_urls = ['assets/FinalArt/HulkJab/Jab_0003_Layer 1.jpg','assets/FinalArt/HulkJab/Jab_0002_Layer 2.jpg', 'assets/FinalArt/HulkJab/Jab_0001_Layer 3.jpg', 'assets/FinalArt/HulkJab/Jab_0000_Layer 4.jpg'];
    var hulkpunch_urls = ['assets/FinalArt/HulkPunch/Punch_0009_Layer 1.jpg',
                          'assets/FinalArt/HulkPunch/Punch_0008_Layer 2.jpg', 
                          'assets/FinalArt/HulkPunch/Punch_0007_Layer 3.jpg', 
                          'assets/FinalArt/HulkPunch/Punch_0006_Layer 4.jpg',
                          'assets/FinalArt/HulkPunch/Punch_0005_Layer 5.jpg',
                          'assets/FinalArt/HulkPunch/Punch_0004_Layer 6.jpg',
                          'assets/FinalArt/HulkPunch/Punch_0003_Layer 7.jpg',
                          'assets/FinalArt/HulkPunch/Punch_0002_Layer 8.jpg',
                          'assets/FinalArt/HulkPunch/Punch_0001_Layer 9.jpg',
                          'assets/FinalArt/HulkPunch/Punch_0000_Layer 10.jpg',
                         ];
    var hulkidle_images = [];
    for (t = 0; t < hulkidle_urls.length; t++) {
        hulkidle_images[t] = new Image();
        hulkidle_images[t].src = hulkidle_urls[t];
    }
    var hulkjab_images = [];
    for (u = 0; u < hulkjab_urls.length; u++) {
        hulkjab_images[u] = new Image();
        hulkjab_images[u].src = hulkjab_urls[u];
    }
    var hulkpunch_images = [];
    for (v = 0; v < hulkpunch_urls.length; v++) {
        hulkpunch_images[v] = new Image();
        hulkpunch_images[v].src = hulkpunch_urls[v];
    }
    
    
    
    
    
    
      $(document).ready(function(){
        /*********CHANGE HELP TEXT TO TAP WHEN ON MOBILE****/  
        function isMobile() {
          try{ document.createEvent("TouchEvent"); return true; }
          catch(e){ return false; }
        }
        if(isMobile() == true){
            //console.log("should say click"); 
            $(".webcamhelpertext").text("Tap To Change Filter");
            $(".approvehelpertext").text("Tap To Change Filter");
        }
          
       // var webvideo = document.getElementById('videoElement');
        var wCanvas = document.getElementById('webcamcanvas');  
        var selectedBody = "hulk";  
        var clip_image = new Image();
        clip_image.src = 'assets/FinalArt/leia_facearea.png';
        var imageLeia = new Image();
        imageLeia.src = 'assets/FinalArt/LeiaHeadSingle.png'; 
        var faces = { 
            leia : {   clipurl:'assets/FinalArt/leia_facearea.png',
                       pngurl:['assets/FinalArt/LeiaHead/head_0006_Layer-1.png',
                              'assets/FinalArt/LeiaHead/head_0005_Layer-2.png',
                              'assets/FinalArt/LeiaHead/head_0004_Layer-3.png',
                              'assets/FinalArt/LeiaHead/head_0003_Layer-4.png']
                   },
            pussyhat : {   clipurl:'assets/FinalArt/pussyhat_facearea.png',
                           pngurl:['assets/FinalArt/PussyHatHead/head_0004_Layer-1.png',
                              'assets/FinalArt/PussyHatHead/head_0003_Layer-2.png',
                              'assets/FinalArt/PussyHatHead/head_0002_Layer-3.png',
                              'assets/FinalArt/PussyHatHead/head_0001_Layer-4.png']
                       },
            hat : {   clipurl:'assets/FinalArt/hat_facearea.png',
                           pngurl:['assets/FinalArt/HatHead/head_0004_Layer-1.png',
                              'assets/FinalArt/HatHead/head_0003_Layer-2.png',
                              'assets/FinalArt/HatHead/head_0002_Layer-3.png',
                              'assets/FinalArt/HatHead/head_0001_Layer-4.png']
                       }
        };
        
        var leiahead_images = [];
        for (p = 0; p < faces["leia"].pngurl.length; p++) { 
            leiahead_images[p] = new Image();
            leiahead_images[p].src = faces["leia"].pngurl[p];
        }  
        var pussyhathead_images = [];
        for (q = 0; q < faces["pussyhat"].pngurl.length; q++) { 
            pussyhathead_images[q] = new Image();
            pussyhathead_images[q].src = faces["pussyhat"].pngurl[q];
        }  
        var hathead_images = [];
        for (r = 0; r < faces["hat"].pngurl.length; r++) { 
            hathead_images[r] = new Image();
            hathead_images[r].src = faces["hat"].pngurl[r];
        }  
        for(var key in faces) {
            if (faces.hasOwnProperty(key)) {
                preloadImage(faces[key].clipurl);
            }
        }
        var currentface = "leia";
          
          
          
          
        fullpage.initialize('#fullpage', {
            anchors: ['Step1', 'Step2', 'Step3'],
            menu: '#menu',
            css3:true
        });
          
        /**********CAPTURE STEP 4**********/  
        var step4Input = document.getElementsByClassName("step4input w-input")[0];
        
        step4Input.addEventListener("input", function(e) {
            inputText4 = step4Input.value;
            console.log("Trump Message: " + inputText4);
        }, false);
        /****************************************/  
        
        /* CODE TO DISPLAY WEBCAM FEED ON MODAL WINDOW */ 
        var video = document.querySelector("#videoElement");
        var track; 
        var overlayImageUrls = ["assets/FinalArt/hat.gif", "assets/FinalArt/pussyhat.gif", "assets/FinalArt/LeiaHead2.gif"]; 
        var overlayindex = 0; 

        $( ".step2icon" ).on('touchend click', function(){
            
            $(".step2icon").transition({scale: 1.1 }, 100, 'in', function() {
                 
                $(".step2icon").transition({scale: 1.0 }, 350, 'in', function() {   
                $('.modaldiv').css('display', 'inline-block');
                    $('.modalcontent').css('display', 'inline-block');
                    $(".webcamoverlayimage").hide(); 
                    Webcam.set({
                        width: 600,
                        height: 450,
                        flip_horiz: true
                    });
                    Webcam.attach( '#videoElement' );

                    Webcam.on( 'live', function() {
                          $(".webcamoverlayimage").show(); 
                            handleVideo();
                    } );
                }); 
            }); 
        });
        
        $( ".step2icon" ).hover( 
            function(){  
                $(".step2icon").transition({opacity: 0.4 }, 250, 'in'); 
            },
            function(){  
                $(".step2icon").transition({opacity: 1.0 }, 100, 'in'); 
            }
        );    
          
        
        function preloadImage(url)
        {
            var img=new Image();
            img.src=url;
        }  

        function handleVideo() {
             var aspectOImage = $(".webcamoverlayimage").width()/$(".webcamoverlayimage").height();
            
            assignCurrentFace(overlayindex);
            
            var img = new Image();
            img.onload = function()
            {
                // Load completed
                $(".webcamoverlayimage").attr('src', this.src);
            };
            img.src = overlayImageUrls[overlayindex];
            
            //setTimeout(function() {
                 var maskH = $( "#videoElement" ).find("video").height();
                 var maskW = maskH * aspectOImage; 
                console.log("video h: " + $("#videoElement").height() + "overlayw: " + maskW + " aspect: " + aspectOImage ); 
                 $( ".webcamoverlayimage" ).width(maskW);
                 $( ".webcamoverlayimage" ).height("auto");
                 $(".approveimage").width($( ".webcamoverlayimage" ).width());
                $(".approveimage").height("auto");
           // }, 2000);
        }
          
        function assignCurrentFace(indexNum){
            if(indexNum ==0){
                currentface = "hat"; 
            }
            else if(indexNum ==1){
                currentface = "pussyhat";
            }
            else if(indexNum ==2){
                currentface = "leia";
            }
        }
            
        //cycle overlay images 
        $( ".modalcanvasdiv" ).on('touchend click', function(){
              if (x) clearTimeout(x);
              x = setTimeout(function() {
                    overlayindex++; 
                    if(overlayindex >= overlayImageUrls.length){
                        overlayindex = 0; 
                    }
                    assignCurrentFace(overlayindex);
                    $(".webcamoverlayimage").attr('src', overlayImageUrls[overlayindex]);
                    //changeImageSrc($(".webcamoverlayimage"),overlayImageUrls[overlayindex]);
                    if( $('.webcamhelpertext').is(':visible')){
                        $('.webcamhelpertext').hide(); 
                    }
                 y++;
                 console.log(y);
                 // ----------------
              }, 100);
        });  
          
        //retake photo  
        $( ".nobutton" ).on('touchend click', function(){ 
            $(".nobutton").transition({scale: 1.15 }, 100, 'in', function() {     
                $(".nobutton").transition({scale: 1.0 }, 250, 'in', function() {    
                    $('.modalcontent').show(); 
                });
            });
        });
        $( ".nobutton" ).hover( 
            function(){  
                $(".nobutton").transition({opacity: .6 }, 100, 'in'); 
            },
            function(){  
                $(".nobutton").transition({opacity: 1.0 }, 100, 'in'); 
            }
        );
          
        
        //photo approved  
        $( ".yesbutton" ).on('touchend click', function(){  
            $(".yesbutton").transition({scale: 1.15 }, 100, 'in', function() {     
                $(".yesbutton").transition({scale: 1.0 }, 250, 'in', function() {    
                    Webcam.reset();
                    $(".modaldiv").hide();
                    setTimeout(function() {
                        fullpage.moveSectionDown();
                    }, 500);
                });
            }); 
            
        });
        $( ".yesbutton" ).hover( 
            function(){  
                $(".yesbutton").transition({opacity: 0.6 }, 100, 'in'); 
            },
            function(){  
                $(".yesbutton").transition({opacity: 1.0 }, 100, 'in'); 
            }
        );
        
        //id name
        $( "#closeiconwebcam", "#closeiconapprove" ).on('touchend click', function(){
            //track.stop();
            Webcam.reset();
        });
          
          
        //down arrow hovered
        $( ".nextlinkblock" ).hover( 
            function(){  
                $(".nextlinkblock").transition({scale: 1.1 }, 100, 'in'); 
            },
            function(){  
                $(".nextlinkblock").transition({scale: 1.0 }, 100, 'in'); 
            }
        );  
          
        /************DETECT CLICK ANYWHERE********************/  
        $(document).on('touchend click', function(){    
            // When the user clicks anywhere on the document
            console.log("what I clicked: "+$(event.target).attr('class'));
            //close webcam stream
            if ($(event.target).attr('class') == "modaldiv") {
               // track.stop();
                Webcam.reset();
                $(".modaldiv").hide();
            }
            
            if ($(event.target).attr('class') == "hr1") {
                selectedBody = "leia";
                
                $(".hero1link").transition({scale: 1.1 }, 100, 'in', function() {
                    $(".hero1link").transition({ scale: 1.0 }, 350, 'in');
                    $('.hero1link').css('background-color','#666666');
                    $('.hero2link').css('background-color','transparent');
                    $('.hero3link').css('background-color','transparent');
                }); 
                
                console.log("Selected Body: " + selectedBody);
            }
            else if ($(event.target).attr('class') == "hr2") {
                selectedBody = "luther";
                $(".hero2link").transition({scale: 1.1 }, 100, 'in', function() {
                    $(".hero2link").transition({ scale: 1.0 }, 350, 'in');
                    $('.hero2link').css('background-color','#666666');
                    $('.hero1link').css('background-color','transparent');
                    $('.hero3link').css('background-color','transparent');
                }); 
                console.log("Selected Body: " + selectedBody);
            }
            else if ($(event.target).attr('class') == "hr3") {
                selectedBody = "hulk";
                $(".hero3link").transition({scale: 1.1 }, 100, 'in', function() {
                    $(".hero3link").transition({ scale: 1.0 }, 350, 'in');
                    $('.hero3link').css('background-color','#666666');
                    $('.hero2link').css('background-color','transparent');
                    $('.hero1link').css('background-color','transparent');
                }); 
                console.log("Selected Body: " + selectedBody);
            }

        }); 
          
        $( ".hero1link" ).hover( 
            function(){  
                $(".hero1link").transition({opacity: 0.4 }, 200, 'in'); 
            },
            function(){  
                $(".hero1link").transition({opacity: 1.0 }, 100, 'in'); 
            }
        );  
        $( ".hero2link" ).hover( 
            function(){  
                $(".hero2link").transition({opacity: 0.4 }, 200, 'in'); 
            },
            function(){  
                $(".hero2link").transition({opacity: 1.0 }, 100, 'in'); 
            }
        );  
        $( ".hero3link" ).hover( 
            function(){  
                $(".hero3link").transition({opacity: 0.4 }, 200, 'in'); 
            },
            function(){  
                $(".hero3link").transition({opacity: 1.0 }, 100, 'in'); 
            }
        );  
          
          
        /***********************************************/
          
        var tempImages = [];   
        function CreateFacePNGs(){
            var headArray; 
            if(currentface == "leia"){
                headArray = leiahead_images.concat();
            }else if(currentface == "pussyhat"){
                headArray = pussyhathead_images.concat();
            }else if(currentface == "hat"){
                headArray = hathead_images.concat();
            } 
            
            //setup
            var faceCanvas = document.createElement('canvas');
            
            var baseImage = new Image(); 
            baseImage.onload= function(){
                faceCanvas.width = baseImage.width;
                faceCanvas.height = baseImage.height;
                var fctx = faceCanvas.getContext('2d');
            
                //iterate through and add png to bare face
                for (i = 0; i < headArray.length; i++) { 
                    //leiahead_images[i].onload = function(){
                   // console.log("leiaheadimage w: "+ leiahead_images[i].width +" H: " + leiahead_images[i].height);
                        fctx.clearRect(0, 0, baseImage.width,baseImage.height);
                        fctx.drawImage(baseImage,0 ,0, baseImage.width,baseImage.height);
                        fctx.drawImage(headArray[i],xOffset ,yOffset, widthAvailable,heightAvailable);
                        var srcData = faceCanvas.toDataURL('image/png');
                        var tImage = new Image(); 
                        tImage.src = srcData; 
                        console.log("allmyfaces x:" + tImage.width + " h: " + tImage.height);
                        allMyFaces.push(tImage.src); 
                        if(i == 3){ 
                            GenerateGIF(); 
                        }  
                }   
            };
            baseImage.src = bareFaceSrc; 
        }  
          
        function changeImageSrc(domImg,src1)
        {
            var img = new Image();
            img.onload = function()
            {
                // Load completed
                domImg.src = this.src;
                faceImagesLoaded();
            };
            img.src = src1;
        }  
          
        //clip the face and show on the approve window
        $( ".photobutton" ).on('touchend click', function(){
            $(".photobutton").transition({scale: 1.15 }, 100, 'in', function() {     
                $(".photobutton").transition({scale: 1.0 }, 250, 'in', function() {    
                    changeImageSrc(clip_image,faces[currentface]["clipurl"]);
                    changeImageSrc(imageLeia,faces[currentface]["pngurl"][0]);
                    //clip_image.src = faces[currentface]["clipurl"];           
                    //imageLeia.src = faces[currentface]["pngurl"][0];
                });
            }); 
        
        });
        $( ".photobutton" ).hover( 
            function(){  
                $(".photobutton").transition({opacity: .6 }, 100, 'in'); 
            },
            function(){  
                $(".photobutton").transition({opacity: 1.0 }, 100, 'in'); 
            }
        );
          
        var faceImageLoadCounter = 0;   
        function faceImagesLoaded(){
            faceImageLoadCounter++;
            if(faceImageLoadCounter >= 2){
                compileFace();
            }
        }
         
        function compileFace(){  
            
            var pixelOpts = [ { resolution: 32 } ];
            
            
            wCanvas.width = $( "#videoElement" ).find("video").width();
            wCanvas.height = $( "#videoElement" ).find("video").height();
            //console.log("VIDEO ELEMENTWWW: " + wCanvas.width + "VIDEO ELEMENTHH: " + wCanvas.height); 
            var fctx = wCanvas.getContext('2d');
            
            console.log("webcamoverlayimaWIDTH: "+ $( ".webcamoverlayimage" ).width() + "webcamoverlayimaHEIGHT: " + $( ".webcamoverlayimage" ).height() + "x: " + ($(".webcamoverlayimage").offset().left -$(".modalcontent").offset().left) + "y: " + $(".webcamoverlayimage").offset().top );
            xOffset = ($(".webcamoverlayimage").offset().left -$(".modalcontent").offset().left)
            yOffset = $(".webcamoverlayimage").offset().top;
            widthAvailable = $( ".webcamoverlayimage" ).width();
            heightAvailable = $( ".webcamoverlayimage" ).height();
                
            fctx.drawImage(clip_image, ($(".webcamoverlayimage").offset().left -$(".modalcontent").offset().left) ,  $(".webcamoverlayimage").offset().top, $( ".webcamoverlayimage" ).width(), $( ".webcamoverlayimage" ).height());

            /// change composite mode to use that shape
            fctx.globalCompositeOperation = 'source-in';
            
            Webcam.snap( function() {    
                /// draw the image to be clipped
               // fctx.drawImage(webvideo, 0, 0, wCanvas.width, wCanvas.height);   
                fctx.globalCompositeOperation = 'source-over';
                /*Filters.brightness = function(pixels, adjustment) {
                      var d = pixels.data;
                      for (var i=0; i<d.length; i+=4) {
                        d[i] += adjustment;
                        d[i+1] += adjustment;
                        d[i+2] += adjustment;
                      }
                      return pixels;
                };*/
                
                //extract bare face to use later. 
                bareFaceSrc = wCanvas.toDataURL('image/png');  

                fctx.drawImage(imageLeia, ($(".webcamoverlayimage").offset().left -$(".modalcontent").offset().left) ,  $(".webcamoverlayimage").offset().top, $( ".webcamoverlayimage" ).width(), $( ".webcamoverlayimage" ).height());

                faceSrcData = wCanvas.toDataURL('image/png');
                
                //faceImage.onload = faceImageLoaded;
               /* faceImage.onload = function(){
                    $('.modalcontent').hide();
                    $(".approveimage").attr('src', faceSrcData); 
                };*/
                var apImage = $(".approveimage");
                apImage.load(function(){
                     $('.modalcontent').hide();
                });
                apImage.attr("src", faceSrcData);
                faceImageLoadCounter = 0;   
        
                faceImage.src = faceSrcData; 
                
             
                /*var img = document.getElementById('approveimg');
                var myPixelation = new ClosePixelation( img, [
                    { shape: 'circle', resolution: 32, size: 6, offset: 8 },
                    { shape: 'circle', resolution: 32, size: 9, offset: 16 },
                    { shape: 'circle', resolution: 32, size: 12, offset: 24 },
                    { shape: 'circle', resolution: 32, size: 9, offset: 0 }
                ]);*/

            }, wCanvas );
        }
        
        var words = []; 
        function GenerateGIF(){
            console.log("great in g g");
            gifFrames = [];
            var idleArray;
            var jabArray; 
            var punchArray; 
            var headPos = { x:5, y: 116};
            if(selectedBody == "leia"){
                idleArray = leiaidle_images.concat(); 
                jabArray = leiajab_images.concat();
                punchArray = leiapunch_images.concat();
                headPos = { x:42, y: 60};
            }else if(selectedBody == "luther"){
                idleArray = lutheridle_images.concat(); 
                jabArray = lutherjab_images.concat();
                punchArray = lutherpunch_images.concat();
                headPos = { x:108, y: -6};
            }else if(selectedBody == "hulk"){
                idleArray = hulkidle_images.concat(); 
                jabArray = hulkjab_images.concat();
                punchArray = hulkpunch_images.concat();
                headPos = { x:16, y: -9};
            } 
            
            
             for (j = 0; j < idleArray.length; j++) { 
                    
                    var tempCanvas = document.createElement('canvas');
                    tempCanvas.width = 600;
                    tempCanvas.height = 450;
                    var ctx= tempCanvas.getContext("2d");
                    ctx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                    
                    var hcan = document.createElement('canvas');
                    hcan.width = tempCanvas.width;
                    hcan.height = tempCanvas.height;
                    var hctx = hcan.getContext('2d');
                    
                    //clear the heading canvas
                    hctx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                    hctx = hcan.getContext("2d");
                    //hctx.textAlign = "center";
                        
                    ctx.drawImage(idleArray[j], 0, 0);
                    
                    var hRatio = tempCanvas.width/faceImage.width;
                    var vRatio = tempCanvas.height/faceImage.height;
                    var ratio  = Math.min( hRatio, vRatio );
                    
                    var tempImage = new Image(); 
                    tempImage.onload = function(){
                        
                    };
                    /*faceCounter++;
                    if(faceCounter == 4){
                        faceCounter = 0; 
                    }*/
                    tempImage.src = allMyFaces[j]; 
                    //5 ,116,334, 251 LEIA
                    //-21 ,47,337, 253 HULK
                    //71 ,50,337, 253 LUTHER
                    ctx.drawImage(tempImage, 0,0, tempImage.width, tempImage.height, headPos.x ,headPos.y,337, 253);  
                    
                    //hctx.drawImage(click_images[j], 0,0);
                    //ctx.drawImage(hcan, 0,0);
                 
                    var imgData = tempCanvas.toDataURL('image/jpeg');
                    var oneImage = new Image();
                    oneImage.src = imgData;
                    // gifFrames.length = 0; 
                    gifFrames.push(oneImage);
            }
            
            var faceCounter = 0; 
            words.length = 0;
            inputText4 = inputText4.toUpperCase();
            words = inputText4.split(" ");
            var punchArrayLength = 0; 
            for(k=0; k < (words.length); k++){
                if(k < (words.length-1)){
                    punchArrayLength = 4; 
                }
                else if(k == (words.length-1)){
                    punchArrayLength = punchArray.length; 
                }
                for (i = 0; i < punchArrayLength; i++) { 
                    
                    var tempCanvas = document.createElement('canvas');
                    tempCanvas.width = 600;
                    tempCanvas.height = 450;
                    var ctx= tempCanvas.getContext("2d");
                    ctx.clearRect(0, 0, tempCanvas.width, hcan.height);
                    
                    var hcan = document.createElement('canvas');
                    hcan.width = tempCanvas.width;
                    hcan.height = 150;
                    var hctx = hcan.getContext('2d');
                    
                    //clear the heading canvas
                    hctx.clearRect(0, 0, tempCanvas.width, hcan.height);
                    hctx = hcan.getContext("2d");
                    hctx.font = "60px Oswald";
                    hctx.fillStyle = "white";
                    hctx.textAlign = "center";
                    hctx.fillText(words[k],.68*hcan.width,hcan.height/2);
                    
                    
                    //Pointer canvas
                    var pcan = document.createElement('canvas');
                    pcan.width = tempCanvas.width;
                    pcan.height = tempCanvas.height;
                    var pctx = pcan.getContext('2d');
                    pctx.clearRect(0, 0, tempCanvas.width, hcan.height);
                    
                   
                    ctx.drawImage(punchArray[i], 0, 0);
                    
                    var hRatio = tempCanvas.width / faceImage.width;
                    var vRatio = tempCanvas.height / faceImage.height;
                    var ratio  = Math.min ( hRatio, vRatio );
                    
                    var tempImage = new Image(); 
                    tempImage.onload = function(){
                        
                    };
                    faceCounter++;
                    if(faceCounter == 4){
                        faceCounter = 0; 
                    }
                    tempImage.src = allMyFaces[faceCounter]; 
                    //5 ,116,334, 251 LEIA
                    //-21 ,47,337, 253 HULK
                    //71 ,50,337, 253 LUTHER
                    if(selectedBody == "luther"){
                        if(i == 0){
                            headPos = { x:123, y: -74};
                        }else if(i == 1){
                            headPos = { x:147, y: -56};
                        }else if(i == 2){
                            headPos = { x:123, y: -74};
                        }
                        else{
                          headPos = { x:71, y: -50};  
                        }
                    }
                    ctx.drawImage(tempImage, 0,0, tempImage.width, tempImage.height, headPos.x ,headPos.y,337, 253);    
                    if(i != 0){
                        ctx.drawImage(hcan, 0,0);
                    }
                        //clear the heading canvas
                    pctx.clearRect(0, 0, tempCanvas.width, tempCanvas.height);
                    pctx = pcan.getContext("2d");
                    if(faceCounter == 0 && k != (words.length-1)){
                        //click
                        pctx.drawImage(click_images[2], 0,0);
                    }else{
                        //no click
                        pctx.drawImage(click_images[1], 0,0);
                    }
                    
                    //ctx.drawImage(pcan, 0,0);
                    
                    var imgData = tempCanvas.toDataURL('image/jpeg');
                    var oneImage = new Image();
                    oneImage.src = imgData;
                    // gifFrames.length = 0; 
                    gifFrames.push(oneImage);
                    if(i == (punchArray.length-1)){
                        //console.log("ALLFACES: " + allMyFaces); 
                        Giffyfy();   
                    } 
                }
            }
            
        } 
    
    
   // });   
        //Make the Summary GIF
          
        $( "#createButton" ).hover( 
            function(){  
                $("#createButton").transition({opacity: 0.4 }, 250, 'in'); 
            },
            function(){  
                $("#createButton").transition({opacity: 1.0 }, 100, 'in'); 
            }
        );
        $('#createButton').on('touchend click' , function(){
            
            $("#createButton").transition({scale: 1.15 }, 100, 'in', function() {     
                $("#createButton").transition({scale: 1.0 }, 350, 'in', function() {    
                    CreateFacePNGs(); 

                    var opts = {
                      lines: 10 // The number of lines to draw
                    , length: 28 // The length of each line
                    , width: 16 // The line thickness
                    , radius: 42 // The radius of the inner circle
                    , scale: 1 // Scales overall size of the spinner
                    , corners: 1 // Corner roundness (0..1)
                    , color: '#ffffff' // #rgb or #rrggbb or array of colors
                    , opacity: 0.25 // Opacity of the lines
                    , rotate: 0 // The rotation offset
                    , direction: 1 // 1: clockwise, -1: counterclockwise
                    , speed: 1 // Rounds per second
                    , trail: 60 // Afterglow percentage
                    , fps: 20 // Frames per second when using setTimeout() as a fallback for CSS
                    , zIndex: 2e9 // The z-index (defaults to 2000000000)
                    , className: 'spinner' // The CSS class to assign to the spinner
                    , top: '50%' // Top position relative to parent
                    , left: '50%' // Left position relative to parent
                    , shadow: false // Whether to render a shadow
                    , hwaccel: false // Whether to use hardware acceleration
                    , position: 'absolute' // Element positioning
                    }
                   var target = document.getElementById('spinnerParent');
                   $("#spinnerParent").show();
                   spinner = new Spinner(opts).spin(target);    
                });
            }); 
            
            
        });  
    
          
          //PRAVEEN's stuff starts here
        function uploadContent(){

            //First make the data structure to pass to mongo
            var playloop_dict = {};

            playloop_id = generateUUID();
            playloop_dict['scene_name'] = 'AngerTranslator';
            playloop_dict['_id'] = playloop_id;
            playloop_dict['playloop_url'] = PLAYLOOPS_SERVER_URL + '/view/' + playloop_id;

            playloop_dict['text1'] = inputText1;
            playloop_dict['text2'] = inputText4;
            playloop_dict['heroname'] = selectedBody;

            var faces_arr = [];
            var promise_arr = [];
            var blah = [];

            //getall signed requests -> upload to s3 -> get signed request summary -> upload s3 summary -> add playloop

            imageType = "png";
            contentType = "image/" + imageType;
            var faces_s3_promises = allMyFaces.map(
                (currElement, index) => {
                    img_id = generateUUID();
                    img_name = img_id + '.' + imageType;
                    return getS3SignedResponse(img_name, contentType);
                 }
            );

            //first get s3 signatures for PNGs
            Promise.all( faces_s3_promises
            ).then( function (s3_signs) {

                //index all the urls and then
                //upload all the face PNGs
                for (var i=0; i< s3_signs.length; i++){
                    faces_arr[i] = s3_signs[i].url;
                }

                console.log(faces_arr);
                playloop_dict['face_imgs'] = faces_arr;

                return Promise.all(
                        allMyFaces.map(
                            (currElement, index) => {
                                uploadFileToS3( allMyFaces[index],
                                        contentType,
                                        s3_signs[index].signedRequest );
                            }
                        )
                    );
                }
            ).then( function ( s3_results ) {
                    //get the summary image signature
                    imageType = "gif";
                    contentType = "image/" + imageType;           
                    img_name = playloop_id + ".gif";
                    return getS3SignedResponse(img_name, contentType);
                }
            ).then( function( signed_response ) {
                    //upload the summary image
                    var signedRequest = signed_response.signedRequest;
                    var summary_url = signed_response.url;

                    imageType = "gif";
                    contentType = "image/" + imageType;

                    console.log("summary_url" + summary_url);
                    playloop_dict['summary_img'] = summary_url;

                    var file = $(".previewimage").attr("src");

                    return uploadFileToS3( file , contentType, signedRequest );

                }
            ).then ( function( s3_results) {
                    //save the playloop datastructure
                    return  addPlayloop (playloop_dict);

                }
            ).then ( function ( data ) {
                    //finally redirect here
                    $("#spinnerParent").hide();
                    spinner.stop(); 
                    console.log("*** Finished image uploads: " + playloop_dict['playloop_url'])
                    //return $.get(playloop_dict['playloop_url']);
                    window.location.href = playloop_dict['playloop_url'];
                }
            );
    }
        //PRAVEEN's stuff ends here  
  
     function Giffyfy(){
         
                gifshot.createGIF({
                    images: gifFrames,
                    gifWidth: 600, 
                    gifHeight: 450, 
                    interval: 0.17
                }, function(obj) {
                    if(!obj.error) {
                        console.log("making hte GIF"); 
                        var image = obj.image;
                        $('.previewfootersection').show(); 
                        document.getElementById('previewimage').src = image;
                        uploadContent(); 
                    }
                });

      }
    
    

       
    });
                        
     //}
  </script>    
  <!-- [if lte IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif] -->
</body>
</html>