<!DOCTYPE html>
<!--  This site was created in Webflow. http://www.webflow.com -->
<!--  Last Published: Sun Jan 15 2017 09:20:59 GMT+0000 (UTC)  -->
<html data-wf-page="5875327699546d416a201491" data-wf-site="5875327699546d416a201490">
<head>
  <meta charset="utf-8">
  <title>AngerTranslator</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="Webflow" name="generator">
    
    
    
    
    

    
    
    
    
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/angertranslator.webflow.css" rel="stylesheet" type="text/css">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js"></script>
    
  <script type="text/javascript">
    WebFont.load({
      google: {
        families: ["Montserrat:400,700","Oswald:300,400,700"]
      }
    });
  </script>
  <script src="js/modernizr.js" type="text/javascript"></script>
  <link href="https://daks2k3a4ib2z.cloudfront.net/img/favicon.ico" rel="shortcut icon" type="image/x-icon">
  <link href="https://daks2k3a4ib2z.cloudfront.net/img/webclip.png" rel="apple-touch-icon">
    
    
    <script type="text/javascript" src="js/libgif.js"></script>
    <script src='js/gifshot.min.js'></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquerymobile/1.4.5/jquery.mobile.min.js"></script>   
    
    
    
    <link rel="stylesheet" type="text/css" href="javascript.fullPage.css" />
    <script type="text/javascript" src="javascript.fullPage.js"></script>
    
    <!-- load that lib -->
    <script src="js/playloops.js"></script>
    <script src="js/close-pixelate.js"></script>
    

    
</head>
<body class="body">
  <div class="modaldiv" data-ix="displaynoneonload">
    <div class="modalcontent">
      <div class="modalclosediv" data-ix="closemodal"><img class="closeicon" id="closeiconwebcam" src="images/VisualEditor_-_Icon_-_Close-01.svg">
      </div>
      <div class="modalcanvasdiv">
        <h1 class="webcamhelpertext">Tap To Change Filter</h1>
        <img class="webcamoverlayimage" src="assets/FinalArt/LeiaHead.gif">
        <video autoplay="true" class="webcamvideo" id="videoElement"></video> 
        <canvas class="webcamcanvas" id="webcamcanvas"></canvas>
      </div>
      <div class="modalcameradiv"><img class="photobutton" src="images/cricle.png">
      </div>
    </div>
    <div class="modalapprovecontent">
      <div class="modalclosediv" data-ix="closemodal"><img class="closeicon" id="closeiconapprove" src="images/VisualEditor_-_Icon_-_Close-01.svg">
      </div>
      <div class="modalcanvasdiv">
        <h1 class="approvehelpertext">Tap To Change Filter</h1>
        <img class="approveimage" id="approveimg" src="assets/FinalArt/LeiaHead.gif">
      </div>
      <div class="modalyesno">
        <div class="modalyes"><img class="yesbutton" src="images/choices-01.svg">
        </div>
        <div class="modalno"><img class="nobutton" src="images/choices-02.svg">
        </div>
      </div>
    </div>
  </div>
  <div class="headersection">
    <div class="w-container">
      <div class="headerdiv">
        <!--<h1 class="logoheading">Play Loops</h1>-->
           <img class="logoheading" src="images/yellowlogo.svg">  
      </div>
    </div>
  </div>
  <div id="fullpage">
 <!-- <div class="section mostsections hiddensection">
    <div class="w-container">
      <div class="mosteditordivs">
        <div class="stepformwrapper w-form">
          <form class="formdiv" onsubmit="step1Submit()" data-name="Email Form" data-redirect="javascript:void(0);" id="email-form" name="email-form" redirect="javascript:void(0);">
            <div class="stepnumdiv">
              <h1 class="stepnumber">1.</h1><img class="stepnumicon" src="images/symbols-1.svg">
            </div>
            <div class="stepinputdiv">
              <label class="step1title" for="name">I am...</label>
              <input class="step1input1 w-input" data-name="Name" id="name" maxlength="20" name="name" placeholder="Who are you? " type="text">
            </div>
            <div class="stepbutton">
              <a class="w-inline-block" href="#Step2"><img class="nextlinkblock" src="images/25243.svg">
              </a>
            </div>
          </form>
          <div class="w-form-done">
            <div>Thank you! Your submission has been received!</div>
          </div>
          <div class="w-form-fail">
            <div>Oops! Something went wrong while submitting the form</div>
          </div>
        </div>
      </div>
    </div>
  </div> -->
<section class="section mostsections" id="SectionStep3">
    <div class="w-container">
      <div class="mosteditordivs">
        <div class="stepformwrapper w-form">
          <form class="formdiv" data-name="Email Form" id="email-form" name="email-form">
            <div class="stepnumdiv">
              <h1 class="stepnumber">1.</h1><img class="stepnumicon" src="images/symbols-1.svg">
            </div>
            <div class="stepinputdiv">
              <label class="step3title" for="name-3">Choose Your Hero!</label>
              <div class="step3heroesdiv">
                <a class="hero1link w-inline-block" href="#"><img class="hr1" src="images/Leia SVG.svg">
                </a>
                <a class="hero2link w-inline-block" href="#"><img class="hr2" src="images/Luther SVG.svg">
                </a>
                <a class="hero3link w-inline-block" href="#"><img class="hr3" src="images/Hulk SVG.svg">
                </a>
                <a class="hero4link w-inline-block" href="#"><img class="hr4" src="images/Person_icon_BLACK-01.svg">
                </a>
              </div>
            </div>
            <div class="stepbutton three">
              <a class="w-inline-block" href="#Step2"><img class="nextlinkblock" src="images/25243.svg">
              </a>
            </div>
          </form>
          <div class="w-form-done">
            <div>Thank you! Your submission has been received!</div>
          </div>
          <div class="w-form-fail">
            <div>Oops! Something went wrong while submitting the form</div>
          </div>
        </div>
      </div>
    </div>
  </section>      
  <section class="section mostsections" id="SectionStep2">
    <div class="mostcontainers w-container">
      <div class="mosteditordivs">
        <div class="stepformwrapper w-form">
          <form class="formdiv" data-name="Email Form" id="email-form" name="email-form">
            <div class="stepnumdiv">
              <h1 class="stepnumber">2.</h1><img class="stepnumicon" src="images/symbols-1.svg">
            </div>
            <div class="step2 stepinputdiv">
              <div class="step2selfiediv">
                <label class="step2title" for="name-2">Add Your Face!</label>
                <a class="w-inline-block" data-ix="showselfiemodal" href="#"><img class="step2icon" src="images/camera.svg">
                </a>
              </div>
              <div class="step2or">
                <h1 class="step2ortext">or</h1>
              </div>
              <div class="step2uploaddiv">
                <label class="step2title" for="name-2">Upload</label>
                <a class="w-inline-block" href="#"><img class="step2icon upload" src="images/camera.svg">
                </a>
              </div>
            </div>
            <div class="stepbutton two">
              <a class="w-inline-block" href="#Step3"><img class="nextlinkblock" src="images/25243.svg">
              </a>
            </div>
          </form>
          <div class="w-form-done">
            <div>Thank you! Your submission has been received!</div>
          </div>
          <div class="w-form-fail">
            <div>Oops! Something went wrong while submitting the form</div>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <section class="section mostsections" id="SectionStep4">
    <div class="w-container">
      <div class="mosteditordivs">
        <div class="stepformwrapper w-form">
          <form class="formdiv" onsubmit="step4Submit()" data-name="Email Form" data-redirect="javascript:void(0);" id="email-form" name="email-form" redirect="javascript:void(0);">
            <div class="stepnumdiv">
              <h1 class="stepnumber">3.</h1><img class="stepnumicon" src="images/symbols-1.svg">
            </div>
            <div class="stepinputdiv 4" id="step4inputdiv">
              <label class="step4title" for="name-4">Your Message To Trump</label>
              <input class="step4input w-input" data-name="Name 4" id="name-4" maxlength="256" name="name-4" placeholder="NOT MY PRESIDENT" type="text">
            </div>
            <div class="four stepbutton"><a class="submitbutton w-button" href="index.html"  id="createButton" onclick='return false;'>CREATE</a>
            </div>
          </form>
          <div class="w-form-done">
            <div>Thank you! Your submission has been received!</div>
          </div>
          <div class="w-form-fail">
            <div>Oops! Something went wrong while submitting the form</div>
          </div>
        </div>
      </div>
    </div>
  </section>
  </div>
  <div class="mostsections">
    <div class="extraspacecontainer w-container">
      <div class="last mosteditordivs"></div>
    </div>
  </div>
  <div class="previewfootersection">
    <div class="previewfootercontainer w-container">
      <div class="previewfooterdiv">
        <h1 class="footertext">I am<br>Asian American</h1><img class="previewimage" id="previewimage" src="images/LEIA_IDLE_INK.gif">
      </div>
    </div>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js" type="text/javascript"></script>
  <script src="js/webflow.js" type="text/javascript"></script>

<script type="text/javascript">
        //var testImage = new Image();
    var heightAvailable; 
    var widthAvailable;
    var xOffset; 
    var yOffset; 
    var bareFaceSrc; 
    var gifFrames = []; 
    var allMyFaces = []; 
    var faceSrcData;
    var faceImage = new Image(); 
    var inputText1 = "I am American";
    var inputText4 = "He is not my president"; 
    //testImage.src = 'assets/Test/LEIA_IDLE_INK.gif'; 
    var isMobile;
    //timeout variables
    var x, y = 1;
    var leiaidle_urls = ['assets/FinalArt/LeiaIdle/Idle_0003_Layer 1.jpg','assets/FinalArt/LeiaIdle/Idle_0002_Layer 2.jpg', 'assets/FinalArt/LeiaIdle/Idle_0001_Layer 3.jpg', 'assets/FinalArt/LeiaIdle/Idle_0000_Layer 4.jpg'];
    var leiajab_urls = ['assets/FinalArt/LeiaJab/Jab_0003_Layer 1.jpg','assets/FinalArt/LeiaJab/Jab_0002_Layer 2.jpg', 'assets/FinalArt/LeiaJab/Jab_0001_Layer 3.jpg', 'assets/FinalArt/LeiaJab/Jab_0000_Layer 4.jpg'];
    var leiapunch_urls = ['assets/FinalArt/LeiaPunch/Punch_0014_Layer 1.jpg',
                          'assets/FinalArt/LeiaPunch/Punch_0013_Layer 2.jpg', 
                          'assets/FinalArt/LeiaPunch/Punch_0012_Layer 3.jpg', 
                          'assets/FinalArt/LeiaPunch/Punch_0011_Layer 4.jpg',
                          'assets/FinalArt/LeiaPunch/Punch_0010_Layer 5.jpg',
                          'assets/FinalArt/LeiaPunch/Punch_0009_Layer 6.jpg',
                          'assets/FinalArt/LeiaPunch/Punch_0008_Layer 7.jpg',
                          'assets/FinalArt/LeiaPunch/Punch_0007_Layer 8.jpg',
                          'assets/FinalArt/LeiaPunch/Punch_0006_Layer 9.jpg',
                          'assets/FinalArt/LeiaPunch/Punch_0005_Layer 10.jpg',
                          'assets/FinalArt/LeiaPunch/Punch_0004_Layer 11.jpg',
                          'assets/FinalArt/LeiaPunch/Punch_0003_Layer 12.jpg',
                          'assets/FinalArt/LeiaPunch/Punch_0002_Layer 13.jpg',
                          'assets/FinalArt/LeiaPunch/Punch_0001_Layer 14.jpg',
                         ];
    var leiaidle_images = [];
    for (i = 0; i < leiaidle_urls.length; i++) {
        leiaidle_images[i] = new Image();
        leiaidle_images[i].src = leiaidle_urls[i];
    }
    var leiajab_images = [];
    for (j = 0; j < leiajab_urls.length; j++) {
        leiajab_images[j] = new Image();
        leiajab_images[j].src = leiajab_urls[j];
    }
    var leiapunch_images = [];
    for (k = 0; k < leiapunch_urls.length; k++) {
        leiapunch_images[k] = new Image();
        leiapunch_images[k].src = leiapunch_urls[k];
    }
    
    var lutheridle_urls = ['assets/FinalArt/LutherIdle/Idle_0003_Layer 1.jpg','assets/FinalArt/LutherIdle/Idle_0002_Layer 2.jpg', 'assets/FinalArt/LutherIdle/Idle_0001_Layer 3.jpg', 'assets/FinalArt/LutherIdle/Idle_0000_Layer 4.jpg'];
    var lutherjab_urls = ['assets/FinalArt/LutherJab/Jab_0003_Layer 1.jpg','assets/FinalArt/LutherJab/Jab_0002_Layer 2.jpg', 'assets/FinalArt/LutherJab/Jab_0001_Layer 3.jpg', 'assets/FinalArt/LutherJab/Jab_0000_Layer 4.jpg'];
    var lutherpunch_urls = ['assets/FinalArt/LutherPunch/Punch_0014_Layer 1.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0013_Layer 2.jpg', 
                          'assets/FinalArt/LutherPunch/Punch_0012_Layer 3.jpg', 
                          'assets/FinalArt/LutherPunch/Punch_0011_Layer 4.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0010_Layer 5.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0009_Layer 6.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0008_Layer 7.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0007_Layer 8.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0006_Layer 9.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0005_Layer 10.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0004_Layer 11.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0003_Layer 12.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0002_Layer 13.jpg',
                          'assets/FinalArt/LutherPunch/Punch_0001_Layer 14.jpg',
                         ];
    var lutheridle_images = [];
    for (l = 0; l < lutheridle_urls.length; l++) {
        lutheridle_images[l] = new Image();
        lutheridle_images[l].src = lutheridle_urls[l];
    }
    var lutherjab_images = [];
    for (m = 0; m < leiajab_urls.length; m++) {
        lutherjab_images[m] = new Image();
        lutherjab_images[m].src = lutherjab_urls[m];
    }
    var lutherpunch_images = [];
    for (n = 0; n < lutherpunch_urls.length; n++) {
        lutherpunch_images[n] = new Image();
        lutherpunch_images[n].src = lutherpunch_urls[n];
    }
    
    
    var hulkidle_urls = ['assets/FinalArt/HulkIdle/Idle_0003_Layer 1.jpg','assets/FinalArt/HulkIdle/Idle_0002_Layer 2.jpg', 'assets/FinalArt/HulkIdle/Idle_0001_Layer 3.jpg', 'assets/FinalArt/HulkIdle/Idle_0000_Layer 4.jpg'];
    var hulkjab_urls = ['assets/FinalArt/HulkJab/Jab_0003_Layer 1.jpg','assets/FinalArt/HulkJab/Jab_0002_Layer 2.jpg', 'assets/FinalArt/HulkJab/Jab_0001_Layer 3.jpg', 'assets/FinalArt/HulkJab/Jab_0000_Layer 4.jpg'];
    var hulkpunch_urls = ['assets/FinalArt/HulkPunch/Punch_0009_Layer 1.jpg',
                          'assets/FinalArt/HulkPunch/Punch_0008_Layer 2.jpg', 
                          'assets/FinalArt/HulkPunch/Punch_0007_Layer 3.jpg', 
                          'assets/FinalArt/HulkPunch/Punch_0006_Layer 4.jpg',
                          'assets/FinalArt/HulkPunch/Punch_0005_Layer 5.jpg',
                          'assets/FinalArt/HulkPunch/Punch_0004_Layer 6.jpg',
                          'assets/FinalArt/HulkPunch/Punch_0003_Layer 7.jpg',
                          'assets/FinalArt/HulkPunch/Punch_0002_Layer 8.jpg',
                          'assets/FinalArt/HulkPunch/Punch_0001_Layer 9.jpg',
                          'assets/FinalArt/HulkPunch/Punch_0000_Layer 10.jpg',
                         ];
    var hulkidle_images = [];
    for (t = 0; t < hulkidle_urls.length; t++) {
        hulkidle_images[t] = new Image();
        hulkidle_images[t].src = hulkidle_urls[t];
    }
    var hulkjab_images = [];
    for (u = 0; u < hulkjab_urls.length; u++) {
        hulkjab_images[u] = new Image();
        hulkjab_images[u].src = hulkjab_urls[u];
    }
    var hulkpunch_images = [];
    for (v = 0; v < hulkpunch_urls.length; v++) {
        hulkpunch_images[v] = new Image();
        hulkpunch_images[v].src = hulkpunch_urls[v];
    }
    
    
    
    
    
    
      $(document).ready(function(){
        var webvideo = document.getElementById('videoElement');
        var wCanvas = document.getElementById('webcamcanvas');  
        var selectedBody = "hulk";  
        var clip_image = new Image();
        clip_image.src = 'assets/FinalArt/leia_facearea.png';
        var imageLeia = new Image();
        imageLeia.src = 'assets/FinalArt/LeiaHeadSingle.png'; 
        var faces = { 
            leia : {   clipurl:'assets/FinalArt/leia_facearea.png',
                       pngurl:['assets/FinalArt/LeiaHead/head_0006_Layer-1.png',
                              'assets/FinalArt/LeiaHead/head_0005_Layer-2.png',
                              'assets/FinalArt/LeiaHead/head_0004_Layer-3.png',
                              'assets/FinalArt/LeiaHead/head_0003_Layer-4.png']
                   },
            pussyhat : {   clipurl:'assets/FinalArt/pussyhat_facearea.png',
                           pngurl:['assets/FinalArt/PussyHatHead/head_0004_Layer-1.png',
                              'assets/FinalArt/PussyHatHead/head_0003_Layer-2.png',
                              'assets/FinalArt/PussyHatHead/head_0002_Layer-3.png',
                              'assets/FinalArt/PussyHatHead/head_0001_Layer-4.png']
                       },
            hat : {   clipurl:'assets/FinalArt/hat_facearea.png',
                           pngurl:['assets/FinalArt/HatHead/head_0004_Layer-1.png',
                              'assets/FinalArt/HatHead/head_0003_Layer-2.png',
                              'assets/FinalArt/HatHead/head_0002_Layer-3.png',
                              'assets/FinalArt/HatHead/head_0001_Layer-4.png']
                       }
        };
        
        var leiahead_images = [];
        for (p = 0; p < faces["leia"].pngurl.length; p++) { 
            leiahead_images[p] = new Image();
            leiahead_images[p].src = faces["leia"].pngurl[p];
        }  
        var pussyhathead_images = [];
        for (q = 0; q < faces["pussyhat"].pngurl.length; q++) { 
            pussyhathead_images[q] = new Image();
            pussyhathead_images[q].src = faces["pussyhat"].pngurl[q];
        }  
        var hathead_images = [];
        for (r = 0; r < faces["hat"].pngurl.length; r++) { 
            hathead_images[r] = new Image();
            hathead_images[r].src = faces["hat"].pngurl[r];
        }  
        for(var key in faces) {
            if (faces.hasOwnProperty(key)) {
                preloadImage(faces[key].clipurl);
            }
        }
        var currentface = "leia";
          
          
        var aspectOImage = $(".webcamoverlayimage").width()/ $(".webcamoverlayimage").height();   
          
          
        fullpage.initialize('#fullpage', {
            anchors: ['Step1', 'Step2', 'Step3'],
            menu: '#menu',
            css3:true
        });
          
          
        
        /*********HIDE PREVIW ON MOBILE WHEN ENTERING TEXT****/  
        isMobile = window.matchMedia("only screen and (max-width: 760px)");

        $( ".stepinputdiv" ).on('touchend click', function(){
            if (isMobile.matches) {
                $('.previewfootersection').hide();
            } 
        });  
          
        $( "#step4inputdiv" ).on('touchend click', function(){
            if (isMobile.matches) {
                $('.previewfootersection').hide();
            } 
        });    
        

        /*$('.step1input1 w-input').keypress(function(event) {
            if (isMobile.matches) {
                if (event.keyCode == 13 || event.which == 13) {
                   $('.previewfootersection').show(); 
                }
            } 
        });
        $(".step4input w-input").keypress(function(event) {
            if (isMobile.matches) {
                if (event.keyCode == 13 || event.which == 13) {
                   $('.previewfootersection').show(); 
                }
            } 
        }); */
          
        
        /*************************************************/
          
        
        /**********UPDATE PREVIEW TEXT1**********/  
        /*var step1Input = document.getElementsByClassName("step1input1 w-input")[0];
        
        step1Input.addEventListener("input", function(e) {
            inputText1 = step1Input.value;
            console.log("what I wrote: " + inputText1);
            $(".footertext").html("I am" + "<br>" + inputText1);
                     //if (isMobile.matches) {
                //$('.previewfootersection').hide();
            //} 
        }, false);*/
        /****************************************/
          
        /**********CAPTURE STEP 4**********/  
        var step4Input = document.getElementsByClassName("step4input w-input")[0];
        
        step4Input.addEventListener("input", function(e) {
            inputText4 = step4Input.value;
            console.log("Trump Message: " + inputText4);
        }, false);
        /****************************************/  
        
        /* CODE TO DISPLAY WEBCAM FEED ON MODAL WINDOW */ 
        var video = document.querySelector("#videoElement");
        var track; 
        var overlayImageUrls = ["assets/FinalArt/hat.gif", "assets/FinalArt/pussyhat.gif", "assets/FinalArt/LeiaHead2.gif"]; 
        var overlayindex = 0; 
          
        navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia || navigator.oGetUserMedia;

        $( ".step2icon" ).on('touchend click', function(){
            $(".modaldiv").show(); 
            $('.modalcontent').show(); 
            if (navigator.getUserMedia) {       
                navigator.getUserMedia({video: true}, handleVideo, videoError);
            }
        });
        
        function preloadImage(url)
        {
            var img=new Image();
            img.src=url;
        }  

        function handleVideo(stream) {
            video.src = window.URL.createObjectURL(stream);
            track = stream.getTracks()[0];
            
             var maskH = $("#videoElement").height();
             var maskW = maskH * aspectOImage; 
              console.log("width: " + maskW + "height: " + maskH ); 
             $( ".webcamoverlayimage" ).width(maskW);
             $( ".webcamoverlayimage" ).height(maskH);
              $(".approveimage").width(maskW);
            $(".approveimage").height(maskH);
            
            assignCurrentFace(overlayindex);
            
            $(".webcamoverlayimage").attr('src', overlayImageUrls[overlayindex]);
           // $(".webcamoverlayimage").css('z-index',  $('#videoElement').zIndex()+1);
           
        }
          
        function assignCurrentFace(indexNum){
            if(indexNum ==0){
                currentface = "hat"; 
            }
            else if(indexNum ==1){
                currentface = "pussyhat";
            }
            else if(indexNum ==2){
                currentface = "leia";
            }
        }
            
        //cycle overlay images //, .webcamhelpertext
        $( ".modalcanvasdiv" ).on('touchend click', function(){
              if (x) clearTimeout(x);
              x = setTimeout(function() {
                    overlayindex++; 
                    if(overlayindex >= overlayImageUrls.length){
                        overlayindex = 0; 
                    }
                    assignCurrentFace(overlayindex);
                    $(".webcamoverlayimage").attr('src', overlayImageUrls[overlayindex]);
                    if( $('.webcamhelpertext').is(':visible')){
                        $('.webcamhelpertext').hide(); 
                    }
                 y++;
                 console.log(y);
                 // ----------------
              }, 100);
            
        });  
          
        //retake photo  
        $( ".nobutton" ).on('touchend click', function(){  
            $('.modalcontent').show(); 
        });
          
        //photo approved  
        $( ".yesbutton" ).on('touchend click', function(){  
            track.stop();
            CreateFacePNGs(); 
            $(".modaldiv").hide(); 
        });   
        
        //id name
        $( "#closeiconwebcam", "#closeiconapprove" ).on('touchend click', function(){
            track.stop();
        });

        function videoError(e) {
            console.log(e);
        }
        /*********************************************/
          
        /************DETECT CLICK ANYWHERE********************/  
        $(document).on('touchend click', function(){    
            // When the user clicks anywhere on the document
            console.log("what I clicked: "+$(event.target).attr('class'));
            //close webcam stream
            if ($(event.target).attr('class') == "modaldiv") {
                track.stop();
                $(".modaldiv").hide();
            }
            
            //show preview after input entered
            if ($(event.target).attr('class') != "step1input1 w-input") {
                if (isMobile.matches) {
                    $('.previewfootersection').show();
                }
            }
            
            if ($(event.target).attr('class') == "hr1") {
                selectedBody = "leia";
                $('.hero1link').css('background-color','#666666');
                $('.hero2link').css('background-color','transparent');
                $('.hero3link').css('background-color','transparent');
                console.log("Selected Body: " + selectedBody);
            }
            else if ($(event.target).attr('class') == "hr2") {
                selectedBody = "luther";
                $('.hero2link').css('background-color','#666666');
                $('.hero3link').css('background-color','transparent');
                $('.hero1link').css('background-color','transparent');
                console.log("Selected Body: " + selectedBody);
            }
            else if ($(event.target).attr('class') == "hr3") {
                selectedBody = "hulk";
                $('.hero3link').css('background-color','#666666');
                $('.hero2link').css('background-color','transparent');
                $('.hero1link').css('background-color','transparent');
                console.log("Selected Body: " + selectedBody);
            }

        });   
        /***********************************************/
        var tempImages = [];   
        function CreateFacePNGs(){
            var headArray; 
            if(currentface == "leia"){
                headArray = leiahead_images.concat();
            }else if(currentface == "pussyhat"){
                headArray = pussyhathead_images.concat();
            }else if(currentface == "hat"){
                headArray = hathead_images.concat();
            } 
            
            //setup
            var faceCanvas = document.createElement('canvas');
            

            var baseImage = new Image(); 
            baseImage.onload= function(){
                faceCanvas.width = baseImage.width;
                faceCanvas.height = baseImage.height;
                var fctx = faceCanvas.getContext('2d');
                var myW = xOffset + widthAvailable;
                var myH = yOffset + heightAvailable;
                console.log("baseimage w: "+ baseImage.width +" H: " + baseImage.height + "myW: " + myW+ "myH: "  + myH); 
                fctx.drawImage(baseImage,0 ,0, baseImage.width,baseImage.height);
                
                //iterate through and add png to bare face
                for (i = 0; i < headArray.length; i++) { 
                    //leiahead_images[i].onload = function(){
                  //  console.log("leiaheadimage w: "+ leiahead_images[i].width +" H: " + leiahead_images[i].height);
                        fctx.clearRect(0, 0, baseImage.width,baseImage.height);
                        fctx.drawImage(baseImage,0 ,0, baseImage.width,baseImage.height);
                        fctx.drawImage(headArray[i],xOffset ,yOffset, widthAvailable,heightAvailable);
                        var srcData = faceCanvas.toDataURL('image/png');
                        var tImage = new Image(); 
                        tImage.src = srcData; 
                        console.log("allmyfaces x:" + tImage.width + " h: " + tImage.height);
                        allMyFaces.push(tImage); 
                        if(i == 3){
                            //console.log("before calling Generete GIF"); 
                            GenerateGIF(); 
                        }
                        /* tempImages[i] = new Image();
                        console.log("PNG iteration drawn");
                        tempImages[i].onload = function(){
                            console.log("tempimage onload: " + i);
                            allMyFaces[i] = tempImages[i]; 
                            if(i == 4){
                                console.log("before calling Generete GIF"); 
                                GenerateGIF(); 
                            }
                        };
                        tempImages[i].src = srcData; */
                   // };    
                }   
            };
            baseImage.src = bareFaceSrc; 
        }  
          
        //clip the face and show on the approve window
        $( ".photobutton" ).on('touchend click', function(){
            clip_image.src = faces[currentface]["clipurl"];           
            imageLeia.src = faces[currentface]["pngurl"][0];
            
             var pixelOpts = [ { resolution: 32 } ];
            
            
            wCanvas.width = $( "#videoElement" ).width();
            wCanvas.height = $( "#videoElement" ).height();
            //console.log("VIDEO ELEMENTWWW: " + wCanvas.width + "VIDEO ELEMENTHH: " + wCanvas.height); 
            var fctx = wCanvas.getContext('2d');
            
            imageLeia.onload = function(){
               
                 //  console.log("webcamoverlayimaWIDTH: "+ $( ".webcamoverlayimage" ).width() + "webcamoverlayimaHEIGHT: " + $( ".webcamoverlayimage" //).height() + "x: " + $(".webcamoverlayimage").position().left + "y: " + $(".webcamoverlayimage").position().top );
                xOffset = $(".webcamoverlayimage").position().left;
                yOffset = $(".webcamoverlayimage").position().top;
                widthAvailable = $( ".webcamoverlayimage" ).width();
                heightAvailable = $( ".webcamoverlayimage" ).height();
                
                fctx.drawImage(clip_image, $(".webcamoverlayimage").position().left ,  $(".webcamoverlayimage").position().top, $( ".webcamoverlayimage" ).width(), $( ".webcamoverlayimage" ).height());

                /// change composite mode to use that shape
                fctx.globalCompositeOperation = 'source-in';

                /// draw the image to be clipped
                fctx.drawImage(webvideo, 0, 0, wCanvas.width, wCanvas.height);   
                fctx.globalCompositeOperation = 'source-over';
                /*Filters.brightness = function(pixels, adjustment) {
                      var d = pixels.data;
                      for (var i=0; i<d.length; i+=4) {
                        d[i] += adjustment;
                        d[i+1] += adjustment;
                        d[i+2] += adjustment;
                      }
                      return pixels;
                };*/
                
                //extract bare face to use later. 
                bareFaceSrc = wCanvas.toDataURL('image/png');  

                fctx.drawImage(imageLeia, $(".webcamoverlayimage").position().left ,  $(".webcamoverlayimage").position().top, $( ".webcamoverlayimage" ).width(), $( ".webcamoverlayimage" ).height());

                faceSrcData = wCanvas.toDataURL('image/png');
                faceImage.src = faceSrcData; 
                faceImage.onload = faceImageLoaded;
                
                $('.modalcontent').hide();
                $(".approveimage").attr('src', faceSrcData); 
             
                var img = document.getElementById('approveimg');
                var myPixelation = new ClosePixelation( img, [
                  { shape: 'circle', resolution: 32, size: 6, offset: 8 },
{ shape: 'circle', resolution: 32, size: 9, offset: 16 },
{ shape: 'circle', resolution: 32, size: 12, offset: 24 },
{ shape: 'circle', resolution: 32, size: 9, offset: 0 }
                ]);

            };
        });
          
        function faceImageLoaded() {
           //GenerateGIF();
        }  
        
        //combine face with overlay gif  
       /* function GenerateGIF(){
            var idleArray; 
            var headPos = { x:5, y: 116};
            if(selectedBody == "leia"){
                idleArray = leiaidle_images.concat();
                headPos = { x:5, y: 116};
            }else if(selectedBody == "luther"){
                idleArray = lutheridle_images.concat();
                headPos = { x:71, y: 50};
            }else if(selectedBody == "hulk"){
                idleArray = hulkidle_images.concat();
                headPos = { x:-21, y: 47};
            } 
            
            
                for (i = 0; i < idleArray.length; i++) { 
                    
                    var tempCanvas = document.createElement('canvas');
                    tempCanvas.width = 600;
                    tempCanvas.height = 550;
                    var ctx= tempCanvas.getContext("2d");
                    //var imgData = tempCanvas.toDataURL('image/png');
                    //var imgNewData= ctx.getImageData(0,0, tempCanvas.width, tempCanvas.height);
                    var hcan = document.createElement('canvas');
                    hcan.width = tempCanvas.width;
                    hcan.height = 60;
                    var hctx = hcan.getContext('2d');
                    //clear the heading canvas
                    hctx.clearRect(0, 0, tempCanvas.width, hcan.height);
                    hctx = hcan.getContext("2d");
                    hctx.font = "60px Oswald";
                    hctx.fillStyle = "white";
                    hctx.textAlign = "center";
                    hctx.fillText(inputText1,hcan.width/2,hcan.height/2);

                    ctx.drawImage(hcan, 0, 0);
                    ctx.drawImage(idleArray[i], 0, 100);
                    
                    var hRatio = tempCanvas.width / faceImage.width;
                    var vRatio = tempCanvas.height / faceImage.height;
                    var ratio  = Math.min ( hRatio, vRatio );
                    
                    var tempImage = new Image(); 
                    tempImage.onload = function(){
                        
                    };
                    tempImage.src = allMyFaces[i].src; 
                    //5 ,116,334, 251 LEIA
                    //-21 ,47,337, 253 HULK
                    //71 ,50,337, 253 LUTHER
                    ctx.drawImage(tempImage, 0,0, tempImage.width, tempImage.height, headPos.x ,headPos.y,337, 253);    

                        var imgData = tempCanvas.toDataURL('image/jpeg');
                        var oneImage = new Image();
                        oneImage.src = imgData;
                       // gifFrames.length = 0; 
                        gifFrames.push(oneImage);
                        if(i == 3){
                            console.log("ALLFACES: " + allMyFaces); 
                            Giffyfy();   
                        } 
                }
            //}
        }  */
        var words = []; 
        function GenerateGIF(){
            var jabArray; 
            var punchArray; 
            var headPos = { x:5, y: 116};
            if(selectedBody == "leia"){
                jabArray = leiajab_images.concat();
                punchArray = leiapunch_images.concat();
                headPos = { x:5, y: 116};
            }else if(selectedBody == "luther"){
                jabArray = lutherjab_images.concat();
                punchArray = lutherjab_images.concat();
                headPos = { x:71, y: 50};
            }else if(selectedBody == "hulk"){
                jabArray = hulkjab_images.concat();
                punchArray = hulkjab_images.concat();
                headPos = { x:-21, y: 47};
            } 
            
            words.length = 0;
            inputText4 = inputText4.toUpperCase();
            words = inputText4.split(" ");
            for(k=0; k < (words.length-1); k++){
                for (i = 0; i < jabArray.length; i++) { 
                    
                    var tempCanvas = document.createElement('canvas');
                    tempCanvas.width = 600;
                    tempCanvas.height = 550;
                    var ctx= tempCanvas.getContext("2d");
                    
                    var hcan = document.createElement('canvas');
                    hcan.width = tempCanvas.width;
                    hcan.height = 60;
                    var hctx = hcan.getContext('2d');
                    
                    //clear the heading canvas
                    hctx.clearRect(0, 0, tempCanvas.width, hcan.height);
                    hctx = hcan.getContext("2d");
                    hctx.font = "60px Oswald";
                    hctx.fillStyle = "white";
                    hctx.textAlign = "center";
                    hctx.fillText(words[k],hcan.width/2,hcan.height/2);

                    ctx.drawImage(hcan, 0, 0);
                    ctx.drawImage(jabArray[i], 0, 100);
                    
                    var hRatio = tempCanvas.width / faceImage.width;
                    var vRatio = tempCanvas.height / faceImage.height;
                    var ratio  = Math.min ( hRatio, vRatio );
                    
                    var tempImage = new Image(); 
                    tempImage.onload = function(){
                        
                    };
                    tempImage.src = allMyFaces[i].src; 
                    //5 ,116,334, 251 LEIA
                    //-21 ,47,337, 253 HULK
                    //71 ,50,337, 253 LUTHER
                    ctx.drawImage(tempImage, 0,0, tempImage.width, tempImage.height, headPos.x ,headPos.y,337, 253);    

                    var imgData = tempCanvas.toDataURL('image/jpeg');
                    var oneImage = new Image();
                    oneImage.src = imgData;
                    // gifFrames.length = 0; 
                    gifFrames.push(oneImage);
                    if(i == 3){
                        console.log("ALLFACES: " + allMyFaces); 
                        Giffyfy();   
                    } 
                }
            }
            
             for (m = 0; m < punchArray.length; m++) { 
                    
                    var tempCanvas = document.createElement('canvas');
                    tempCanvas.width = 600;
                    tempCanvas.height = 550;
                    var ctx= tempCanvas.getContext("2d");
                    
                    var hcan = document.createElement('canvas');
                    hcan.width = tempCanvas.width;
                    hcan.height = 60;
                    var hctx = hcan.getContext('2d');
                    
                    //clear the heading canvas
                    hctx.clearRect(0, 0, tempCanvas.width, hcan.height);
                    hctx = hcan.getContext("2d");
                    hctx.font = "60px Oswald";
                    hctx.fillStyle = "white";
                    hctx.textAlign = "center";
                    hctx.fillText(inputText1,hcan.width/2,hcan.height/2);

                    ctx.drawImage(hcan, 0, 0);
                    ctx.drawImage(punchArray[m], 0, 100);
                    
                    var hRatio = tempCanvas.width / faceImage.width;
                    var vRatio = tempCanvas.height / faceImage.height;
                    var ratio  = Math.min ( hRatio, vRatio );
                    
                    var tempImage = new Image(); 
                    tempImage.onload = function(){
                        
                    };
                    tempImage.src = allMyFaces[m].src; 
                    //5 ,116,334, 251 LEIA
                    //-21 ,47,337, 253 HULK
                    //71 ,50,337, 253 LUTHER
                    ctx.drawImage(tempImage, 0,0, tempImage.width, tempImage.height, headPos.x ,headPos.y,337, 253);    

                    var imgData = tempCanvas.toDataURL('image/jpeg');
                    var oneImage = new Image();
                    oneImage.src = imgData;
                    // gifFrames.length = 0; 
                    gifFrames.push(oneImage);
                    if(i == 3){
                        console.log("ALLFACES: " + allMyFaces); 
                        Giffyfy();   
                    } 
                }
            
        }    
          
        //Make the Summary GIF
          
        //PRAVEEN's stuff starts here
        $('#createButton').click(function(){
          
            
            
            //First make the data structure to pass to mongo
            var playloop_dict = {};
            //playloop_dict['face_img'] = allMyFaces;
            playloop_dict['text1'] = inputText1;
            playloop_dict['text2'] = inputText4;
            
            
            //then upload the image
            playloop_id = generatePlayloopID();
            playloop_dict['_id'] = playloop_id;
            
            /*sign_success_callback = function (signed_response) {
                    uploadFileToS3(img_data, img_type, signed_response.signedRequest, signed_response.url);
            }
            
            sign_fail_callback = function(error) { 
                alert("Playloop save failed, couldn't make signature: " + error);
            }*/
            uploadImage(    playloop_id + ".gif", 
                            "image/gif",
                            $(".previewimage").attr("src"),
                            playloop_dict
                        );
            
      
        
             
            
        });
          
          
        //PRAVEEN's stuff ends here
          
      });
    
     function Giffyfy(){
         
                gifshot.createGIF({
                    images: gifFrames,
                    gifWidth: 600, 
                    gifHeight: 550, 
                    interval: 0.15
                }, function(obj) {
                    if(!obj.error) {
                        console.log("making hte GIF"); 
                        var image = obj.image;
                        //animatedImage = document.createElement('img');
                        //animatedImage.src = image;
                        //document.getElementById('resultgif').appendChild(animatedImage);
                        // $(".previewimage").attr('src', image)
                        document.getElementById('previewimage').src = image;
                        //$('#resultgif').show();
                    }
                });
     }
    
    
      function step1Submit(){
        //console.log("heeyyyyy it was submitted!!");
        if (isMobile.matches) {      
            $('.previewfootersection').show(); 
        } 
      } 
    
      function step4Submit(){
        //console.log("heeyyyyy 4454 it was submitted!!");
        if (isMobile.matches) {      
            $('.previewfootersection').show(); 
        } 
      } 
    
      //$('.previewfooterimage').attr('src', 'assets/Test/LEIA_IDLE_INK.gif');
  </script>    
  <!-- [if lte IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif] -->
</body>
</html>